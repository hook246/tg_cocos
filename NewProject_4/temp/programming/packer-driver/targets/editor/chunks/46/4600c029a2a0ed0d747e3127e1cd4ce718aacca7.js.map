{"version":3,"sources":["file:///Users/feiwang/NewProject_4/assets/resources/scripts/discover/UIScrollSelectHorizontal.ts"],"names":["_decorator","Component","Node","CCInteger","CCFloat","EventHandler","log","UITransform","error","ccclass","property","EventType","UIScrollSelectHorizontal","type","tooltip","childs","isTouching","hasTouchMove","isTestX","_touchId","currentIndex","_toMoveX","dx","moveAim","onLoad","i","content","children","length","setPosition","deltaX","getPosition","y","scrollTo","idx","anim","node","name","_checkChildX","emitEvents","selectEvents","target","SCROLL_START","index","scrollToLeft","scrollToRight","child","x","position","Math","min","abs","scaleX","centerScale","minScale","setScale","scale","start","on","TOUCH_START","_onTouch","TOUCH_MOVE","TOUCH_END","_onTouchEnd","TOUCH_CANCEL","event","touch","_startPoint","getStartLocation","evt","getLocation","_move","SCROLL_ING","lo","getComponent","convertToNodeSpaceAR","mx","ceil","event1","SCROLL_END","max","minidx","dt","update","Number","isNaN","stepx","scrollSpeed","lx","round","tox","cx","scrolling"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, CCInteger, CCFloat, EventHandler, log, UITransform, error } from \"cc\";\r\nconst { ccclass, property } = _decorator;\r\n\r\nexport enum EventType {\r\n\tSCROLL_START,\r\n\tSCROLL_ING,\r\n\tSCROLL_END\r\n}\r\n\r\n@ccclass('UIScrollSelectHorizontal')\r\nexport class UIScrollSelectHorizontal extends Component {\r\n\r\n\tpublic static EventType = EventType;\r\n\t@property(Node)\r\n\tcontent: Node = null;\r\n\t@property({\r\n\t\ttype: CCInteger,\r\n\t\ttooltip: '单个控件之间的距离'\r\n\t})\r\n\tdeltaX: number = 100 //x间隔距离\r\n\t@property({\r\n\t\ttype: CCFloat,\r\n\t\ttooltip: '中心点的缩放比例'\r\n\t})\r\n\tcenterScale: number = 1.0\r\n\t@property({\r\n\t\ttype: CCFloat,\r\n\t\ttooltip: '边缘点的缩放比例'\r\n\t})\r\n\tminScale: number = 1.0\r\n\t@property({\r\n\t\ttype: CCFloat,\r\n\t\ttooltip: '滚动时的速度'\r\n\t})\r\n\tscrollSpeed: number = 300;\r\n\t@property({\r\n\t\ttype: EventHandler,\r\n\t\ttooltip: \"选择后的回调\"\r\n\t})\r\n\tselectEvents: Array<EventHandler> = [];\r\n\r\n\tprivate childs: Array<Node> = [];\r\n\tprivate isTouching: boolean = false;\r\n\tprivate hasTouchMove: boolean = false;\r\n\tprivate isTestX: boolean = false;\r\n\tprivate _touchId: any = null;\r\n\tprivate currentIndex: number = 0;\r\n\tprivate _toMoveX: number = 1; //移动方向\r\n\tprivate dx: number = 0;\r\n\tprivate moveAim: number = 0;\r\n\r\n\tonLoad() {\r\n\t\tthis.childs = [];\r\n\t\tfor (var i = 0; i < this.content.children.length; i++) {\r\n\t\t\tthis.childs[i] = this.content.children[i];\r\n\t\t\tthis.childs[i].setPosition(this.deltaX * (i - 1), this.childs[i].getPosition().y);\r\n\t\t\tlog(\"第\" + i + \"个预制体\" + \"，坐标为:\" + this.childs[i].getPosition());\r\n\t\t}\r\n\t\tthis.isTouching = false\r\n\t\tthis.hasTouchMove = false\r\n\t\tthis.isTestX = false;\r\n\t\tthis._touchId = null;\r\n\t\t// this.currentIndex = 0;\r\n\t\tthis.scrollTo(0, false);\r\n\t}\r\n\t/** 滚动到指定节点 \r\n\t * @param anim 是否带移动动画\r\n\t*/\r\n\tscrollTo(idx: number, anim: boolean = true) {\r\n\t\tif (idx < 0 && idx >= this.childs.length) {\r\n\t\t\treturn error(this.node.name + '->移动超出边界面')\r\n\t\t}\r\n\t\tthis.currentIndex = idx;\r\n\t\tthis.moveAim = idx;\r\n\t\tif (!anim) {\r\n\t\t\tfor (var i = 0; i < this.childs.length; i++) {\r\n\t\t\t\tthis._checkChildX(this.childs[i], (i - idx) * this.deltaX)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.isTestX = true\r\n\t\t\tComponent.EventHandler.emitEvents(this.selectEvents, {\r\n\t\t\t\ttarget: this,\r\n\t\t\t\ttype: EventType.SCROLL_START,\r\n\t\t\t\tindex: this.currentIndex\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t/** 向左滚一个点 */\r\n\tscrollToLeft() {\r\n\t\tthis._toMoveX = 1\r\n\t\tthis.scrollTo((this.currentIndex - 1 + this.childs.length) % this.childs.length)\r\n\t}\r\n\r\n\t/** 向左滚一个点 */\r\n\tscrollToRight() {\r\n\t\tthis._toMoveX = -1\r\n\t\tthis.scrollTo((this.currentIndex + 1 + this.childs.length) % this.childs.length)\r\n\t}\r\n\r\n\t_checkChildX(child, x) {\r\n\t\tif (x > this.childs.length / 2 * this.deltaX) {\r\n\t\t\tx -= this.childs.length * this.deltaX\r\n\t\t} else if (x < -this.childs.length / 2 * this.deltaX) {\r\n\t\t\tx += this.childs.length * this.deltaX\r\n\t\t}\r\n\t\tchild.setPosition(x, child.position.y);\r\n\t\tlet dx = Math.min(Math.abs(x), this.deltaX)\r\n\t\tlet scaleX = (1 - dx / this.deltaX) * (this.centerScale - this.minScale) + this.minScale;\r\n\t\tchild.setScale(scaleX, child.scale.y);\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis.content.on(Node.EventType.TOUCH_START, this._onTouch, this);\r\n\t\tthis.content.on(Node.EventType.TOUCH_MOVE, this._onTouch, this);\r\n\t\tthis.content.on(Node.EventType.TOUCH_END, this._onTouchEnd, this);\r\n\t\tthis.content.on(Node.EventType.TOUCH_CANCEL, this._onTouchEnd, this);\r\n\t}\r\n\t_onTouch(event) {\r\n\t\tif (this._touchId != null && (event.touch._startPoint.x != this._touchId._startPoint.x) && (event.touch._startPoint.y != this._touchId._startPoint.y)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (event.type == Node.EventType.TOUCH_START) {\r\n\t\t\tthis.isTouching = true;\r\n\t\t\tthis.hasTouchMove = false\r\n\t\t\tthis.isTestX = false;\r\n\t\t\tthis._touchId = event.touch;\r\n\t\t\tthis.dx = event.getStartLocation().x;\r\n\t\t\tlog(\"触碰\", event.getStartLocation())\r\n\t\t\tlet evt = {\r\n\t\t\t\ttarget: this,\r\n\t\t\t\ttype: EventType.SCROLL_START,\r\n\t\t\t\tindex: this.currentIndex\r\n\t\t\t}\r\n\t\t\tComponent.EventHandler.emitEvents(this.selectEvents, evt);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.hasTouchMove = true;\r\n\t\tvar dx = event.getLocation().x - this.dx\r\n\t\tthis._move(dx);\r\n\t\tthis.dx = event.getLocation().x\r\n\t\tvar evt = {\r\n\t\t\ttarget: this,\r\n\t\t\ttype: EventType.SCROLL_ING,\r\n\t\t\tdx: this.dx\r\n\t\t}\r\n\t\tComponent.EventHandler.emitEvents(this.selectEvents, evt);\r\n\t}\r\n\t_onTouchEnd(event) {\r\n\t\tif (this._touchId != null && (event.touch._startPoint.x != this._touchId._startPoint.x) && (event.touch._startPoint.y != this._touchId._startPoint.y)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.isTouching = false;\r\n\t\tif (event.type == Node.EventType.TOUCH_END || event.type == Node.EventType.TOUCH_CANCEL) {\r\n\t\t\tthis._touchId = null;\r\n\t\t}\r\n\t\tlet lo = this.node.getComponent(UITransform).convertToNodeSpaceAR(event.getLocation())\r\n\t\tif (!this.hasTouchMove) {\r\n\r\n\t\t\tlet mx = Math.ceil((lo.x - this.deltaX / 2) / this.deltaX)\r\n\t\t\tif (mx === 0) {\r\n\t\t\t\tvar event1 = {\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\ttype: EventType.SCROLL_END,\r\n\t\t\t\t\tindex: this.currentIndex\r\n\t\t\t\t}\r\n\t\t\t\tComponent.EventHandler.emitEvents(this.selectEvents, event1);\r\n\t\t\t} else {\r\n\t\t\t\tthis.moveAim = (this.currentIndex + mx + this.childs.length) % this.childs.length\r\n\t\t\t\tthis._toMoveX = mx > 0 ? -1 : 1\r\n\t\t\t\tthis.isTestX = true;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet max = this.deltaX;\r\n\t\tlet minidx = 0\r\n\t\tfor (let i = 0; i < this.childs.length; i++) {\r\n\t\t\tif (Math.abs(this.childs[i].position.x) <= max) {\r\n\t\t\t\tmax = Math.abs(this.childs[i].position.x)\r\n\t\t\t\tminidx = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.moveAim = minidx\r\n\t\tthis._toMoveX = this.childs[minidx].position.x >= 0 ? -1 : 1\r\n\t\tthis.isTestX = true;\r\n\t}\r\n\t_move(dt) {\r\n\t\tfor (var i = 0; i < this.childs.length; i++) {\r\n\t\t\tthis._checkChildX(this.childs[i], this.childs[i].position.x + dt)\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(dt) {\r\n\t\tif (this.isTouching || !this.isTestX || Number.isNaN(this.moveAim)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar stepx = this._toMoveX * dt * this.scrollSpeed\r\n\t\tlet lx = this.childs[this.moveAim].position.x\r\n\t\tfor (var i = 0; i < this.childs.length; i++) {\r\n\t\t\tthis._checkChildX(this.childs[i], this.childs[i].position.x + stepx)\r\n\t\t}\r\n\r\n\t\tvar x = this.childs[0].position.x;\r\n\t\tvar idx = Math.round(x / this.deltaX);\r\n\t\tvar tox = this.deltaX * idx;\r\n\t\tlet cx = this.childs[this.moveAim].position.x\r\n\t\tif (lx * cx < 0 && Math.abs(cx) < this.deltaX) {\r\n\t\t\tthis.isTestX = false;\r\n\t\t\tfor (let i = 0; i < this.childs.length; i++) {\r\n\t\t\t\tif (Math.abs(this.childs[i].position.x) <= Math.abs(stepx)) {\r\n\t\t\t\t\tthis.currentIndex = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < this.childs.length; i++) {\r\n\t\t\t\tthis._checkChildX(this.childs[i], this.childs[i].position.x + tox - x)\r\n\t\t\t}\r\n\t\t\tvar event = {\r\n\t\t\t\ttarget: this,\r\n\t\t\t\ttype: EventType.SCROLL_END,\r\n\t\t\t\tindex: this.currentIndex\r\n\t\t\t}\r\n\t\t\tComponent.EventHandler.emitEvents(this.selectEvents, event);\r\n\t\t}\r\n\t}\r\n\r\n\tscrolling() {\r\n\t\tlog(\"scrolling\");\r\n\t}\r\n}\r\n"]}