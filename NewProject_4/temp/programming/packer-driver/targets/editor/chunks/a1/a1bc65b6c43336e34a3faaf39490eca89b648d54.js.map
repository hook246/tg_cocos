{"version":3,"sources":["file:///Users/feiwang/tg_cocos/NewProject_4/assets/resources/scripts/profile/profileView.ts"],"names":["_decorator","EditBox","Label","Node","tween","UIOpacity","basePageView","GlobalData","WebUtils","homeView","ccclass","property","avatars","profileView","avatar","start","update","deltaTime","showEditPage","edit_page","active","closeEditPage","resetBindUi","bindBtn","unbindBtn","twitterUserName","node","setTwitterInfo","taskData","data","string","getRemoteImg","window","Telegram","WebApp","initDataUnsafe","user","photo_url","user_proto","tgId","id","getResouceImg","user_avatar","username","length","user_name","first_name","last_name","selectAvatar","event","current_select_avatar","select_circle","setPosition","currentTarget","getPosition","editUserInfo","url","isProduction","userInfo","axios","post","userName","edit_username","headers","token","home","getComponent","setProfile","showAlert","console","log","error","showPopup","title","message","buttons","text","buttonId","closeProfile","to","opacity","call"],"mappings":"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","sourcesContent":["import { _decorator, Component, EditBox, EventTouch, Label, Node, tween, UIOpacity } from 'cc';\nimport { basePageModel } from '../common/basePageModel';\nimport { basePageView } from '../common/basePageView';\nimport GlobalData from '../home/GloabalClass';\nimport WebUtils from '../common/WebUtils';\nimport { homeView } from '../home/homeView';\nimport { profileModel } from './profileModel';\nconst { ccclass, property } = _decorator;\n\nconst avatars =[\n    'images/avatar/1',\n    'images/avatar/2',\n    'images/avatar/3',\n    'images/avatar/4',\n    'images/avatar/5'\n]\n\n@ccclass('profileView')\nexport class profileView extends basePageView {\n\n    @property(Node)\n    bindBtn: Node\n\n    @property(Node)\n    unbindBtn: Node\n\n    @property(Label)\n    twitterUserName: Label\n\n    @property(Label)\n    user_name: Label\n\n    @property(Label)\n    tgId: Label\n\n    @property(Node)\n    user_proto: Node\n\n    @property(Node)\n    home: Node\n\n    @property(Node)\n    edit_page: Node\n\n    @property(Node)\n    user_avatar: Node\n\n    @property(Node)\n    select_circle: Node\n\n    @property(Node)\n    current_select_avatar: Node\n\n    @property(EditBox)\n    edit_username: EditBox\n\n    avatar:string\n\n    start() {\n\n    }\n\n    update(deltaTime: number) {\n        \n    }\n\n    showEditPage(){\n        this.edit_page.active = true\n    }\n\n    closeEditPage(){\n        this.edit_page.active = false\n    }\n\n    resetBindUi(){\n        this.bindBtn.active = true\n        this.unbindBtn.active = false\n        this.twitterUserName.node.active = false\n    }\n\n    setTwitterInfo(){\n        if(GlobalData.taskData.data.data.twitterUserName){\n            this.bindBtn.active = false\n            this.unbindBtn.active = true\n            this.twitterUserName.node.active = true\n            this.twitterUserName.string = GlobalData.taskData.data.data.twitterUserName\n        }else{\n            this.bindBtn.active = true\n            this.unbindBtn.active = false\n            this.twitterUserName.node.active = false\n        }\n\n        WebUtils.getRemoteImg(window?.Telegram?.WebApp?.initDataUnsafe?.user?.photo_url, this.user_proto)\n\n        this.tgId.string = `${window?.Telegram?.WebApp?.initDataUnsafe?.user?.id}`\n        WebUtils.getResouceImg(GlobalData.avatar,this.user_avatar)\n        if(GlobalData?.username?.length){\n            this.user_name.string = GlobalData.username\n\n        }else if(window?.Telegram?.WebApp?.initDataUnsafe?.user?.username){\n            this.user_name.string = `${window?.Telegram?.WebApp?.initDataUnsafe?.user?.username}`\n        }else{\n            this.user_name.string = `${window?.Telegram?.WebApp?.initDataUnsafe?.user?.first_name}_${window?.Telegram?.WebApp?.initDataUnsafe?.user?.last_name}`   \n        }\n    }\n\n    selectAvatar(event: EventTouch, data: string){\n        this.avatar = avatars[data]\n        WebUtils.getResouceImg(this.avatar,this.current_select_avatar)\n        this.select_circle.setPosition(event.currentTarget.getPosition())\n    }\n\n    async editUserInfo(){\n        try {\n            const url = GlobalData.isProduction ? 'https://api.infinityg.ai/api/v1/user/info/edit' : 'https://api.infinitytest.cc/api/v1/user/info/edit'\n            const userInfo = await window.axios.post<any>(\n                url\n              ,{\n                avatar: this.avatar,\n                userName: this.edit_username.string ? this.edit_username.string : GlobalData.username\n              \n              },{\n                  headers: { \n                        'Authorization': `Bearer ${GlobalData.token}`\n                    }\n              });\n              WebUtils.getResouceImg(this.avatar,this.user_avatar)\n              this.home.getComponent(homeView).setProfile(this.avatar)\n              this.user_name.string = this.edit_username.string ? this.edit_username.string : GlobalData.username\n              window.Telegram.WebApp.showAlert(\"success!\", () => {\n                console.log(\"\");\n              });\n        } catch (error) {\n            window.Telegram.WebApp.showPopup({\n                title: '',\n                message: '*This username already exists, please reset.',\n                buttons: [\n                  { id: 'button1', text: 'ok' },\n                ]\n              }, async (buttonId) => {\n              });\n        }\n\n    }\n\n\n    closeProfile(){\n        tween(this.node.getComponent(UIOpacity)).to(0.5, { opacity: 0 }).call(()=>{\n            this.node.setPosition(-5000, 0)\n        }).start();\n\n    }\n}\n\n"]}