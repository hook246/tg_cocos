{"version":3,"sources":["file:///Users/feiwang/tg_cocos/NewProject_4/assets/resources/scripts/draw/drawView.ts"],"names":["_decorator","Label","Node","basePageView","GlobalData","ccclass","property","openRewardPos","drawView_arrow","drawView","timer_add","drawLuckyInfo","start","localStorage","getItem","arrow","active","arrow_s","update","deltaTime","drawTime","joinBtn","current_time","formatTimestamp","timer","string","controlUnbindBtnVisible","visible","unBindWalletInfo","controlBindBtnVisible","bindWalletInfo","controlConnectWalletBtnsVisible","walletConnectBtns","showConnectWalletBtns","home","getChildByName","setWalletInfo","address","wallet_address","substring","length","timestamp","date","Date","now","years","getFullYear","months","getMonth","weeks","Math","floor","getTime","days","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","setDrawLuckRewardInfo","setDrawLuckInfo","rewardInfo","join_count","count","showOpenRewardInfo","setCurrentTicketsUsdtCount","info","tickets","tiket","usdt","closeBtnConnectWallets","markArrow","scroll","data","setItem","getScrollOffset","y","console","log"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, ScrollView } from \"cc\";\nimport { basePageView } from \"../common/basePageView\";\nimport GlobalData from \"../home/GloabalClass\";\nimport { ticketsUsdt } from \"./drawModel\";\nconst { ccclass, property } = _decorator;\n\nconst openRewardPos = 1000\nconst drawView_arrow = 'drawView_arrow'\n\nexport interface QueryDrawRespDTO {\n  confirm: boolean;\n  example: false;\n  //开奖信息是否确认：false:未确认,true:已确认\n\n  count: number;\n  //当前参加抽奖人数\n\n  drawId: number;\n  //当前奖池ID\n\n  drawTime: number;\n  //当前抽奖剩余开奖时间，时间戳\n\n  join: boolean;\n  openDrawId: number;\n  //已开奖的奖池ID\n\n  usdt: number;\n  //中奖奖品\n\n  win: boolean;\n}\n\n@ccclass(\"drawView\")\nexport class drawView extends basePageView {\n  @property(Node)\n  walletConnectBtns: Node;\n\n  @property(Node)\n  unBindWalletInfo: Node;\n\n  @property(Node)\n  bindWalletInfo: Node;\n\n  @property(Label)\n  address: Label;\n\n  @property(Node)\n  home: Node;\n\n  @property(Node)\n  joinBtn: Node;\n\n  @property(Node)\n  arrow: Node;\n\n  @property(Node)\n  arrow_s: Node;\n\n  //门票和usdt数量设置\n  @property(Label)\n  tickets: Label;\n\n  @property(Label)\n  usdt: Label;\n\n  //开奖信息\n  @property(Label)\n  join_count: Label;\n\n  @property(Label)\n  timer: Label;\n\n  timer_add = 0\n  drawLuckyInfo: QueryDrawRespDTO;\n\n  async start() {\n    if(localStorage.getItem(drawView_arrow)){\n      this.arrow.active = false\n      this.arrow_s.active = true\n    }\n  }\n\n  update(deltaTime: number) {\n    this.timer_add = this.timer_add + deltaTime\n    if(this.timer_add >= 1){\n      this.drawLuckyInfo.drawTime = this.drawLuckyInfo.drawTime - 1000\n      if(this.drawLuckyInfo.drawTime <= 5000){\n        this.joinBtn.active = false\n        \n      }\n      const current_time = this.formatTimestamp(this.drawLuckyInfo.drawTime)\n      this.timer.string = current_time\n      this.timer_add = 0\n    }\n  }\n\n  controlUnbindBtnVisible(visible: boolean) {\n    this.unBindWalletInfo.active = visible;\n  }\n\n  controlBindBtnVisible(visible: boolean) {\n    this.bindWalletInfo.active = visible;\n  }\n\n  controlConnectWalletBtnsVisible(visible: boolean) {\n    this.walletConnectBtns.active = visible;\n  }\n\n  showConnectWalletBtns() {\n    this.controlConnectWalletBtnsVisible(true);\n    this.home.getChildByName(\"tap_btns\").active = false;\n  }\n\n  setWalletInfo(address: string) {\n    GlobalData.wallet_address = address;\n    this.controlBindBtnVisible(false);\n    this.controlUnbindBtnVisible(true);\n    this.address.string = `${address.substring(0, 6)}...${address.substring(\n      address.length - 6\n    )}`;\n  }\n\n  //设置当前的倒计时\n  formatTimestamp(timestamp: number): string {\n    const date = new Date(timestamp);\n    const now = new Date();\n    let years = now.getFullYear() - date.getFullYear();\n    let months = now.getMonth() - date.getMonth();\n    let weeks = Math.floor((now.getTime() - date.getTime()) / (7 * 24 * 60 * 60 * 1000));\n    let days = now.getDate() - date.getDate();\n    let hours = now.getHours() - date.getHours();\n    let minutes = now.getMinutes() - date.getMinutes();\n    let seconds = now.getSeconds() - date.getSeconds();\n  \n    // 处理跨日的情况\n    if (seconds < 0) {\n      seconds += 60;\n      minutes--;\n    }\n    if (minutes < 0) {\n      minutes += 60;\n      hours--;\n    }\n    if (hours < 0) {\n      hours += 24;\n      days--;\n    }\n    if (days < 0) {\n      days += 7;\n      weeks--;\n    }\n  \n    // 调整年份和月份，因为年份和月份的计算可能不准确\n    if (months < 0 || (months === 0 && (days < 0 || (days === 0 && hours < 0)))) {\n      years--;\n      months += 12;\n    }\n  \n    return `${years} 年 ${months + 1} 月 ${weeks} 周 ${days} 天 ${hours} 时 ${minutes} 分 ${seconds} 秒`;\n  }\n\n  //设置当前获奖的信息\n  setDrawLuckRewardInfo() {}\n\n  //设置当前开奖情况的信息\n  setDrawLuckInfo(rewardInfo :QueryDrawRespDTO) {\n    this.drawLuckyInfo = rewardInfo\n    this.join_count.string = `${rewardInfo.count}`\n\n  }\n\n  //展示当前的开奖信息\n  showOpenRewardInfo(){\n\n  }\n\n  //设置当前的门票和usdt的信息\n  setCurrentTicketsUsdtCount(info: ticketsUsdt){\n    this.tickets.string = `${info.tiket}`\n    this.usdt.string = `${info.usdt}`\n  }\n\n  closeBtnConnectWallets() {\n    this.controlConnectWalletBtnsVisible(false);\n    this.home.getChildByName(\"tap_btns\").active = true;\n  }\n\n  markArrow(scroll: ScrollView, data){\n    localStorage.setItem(drawView_arrow, 'drawView_arrow')\n    this.arrow.active = false\n    this.arrow_s.active = true\n\n    if(scroll.getScrollOffset().y >= openRewardPos){\n\n    }\n    console.log('=====scroll', scroll, data)\n  }\n}\n"]}