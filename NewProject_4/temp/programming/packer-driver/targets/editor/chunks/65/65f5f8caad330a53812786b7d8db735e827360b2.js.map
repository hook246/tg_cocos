{"version":3,"sources":["file:///Users/feiwang/tg_cocos/NewProject_4/assets/resources/scripts/discover/UIScrollSelectHorizontal.ts"],"names":["_decorator","Component","Node","CCInteger","CCFloat","EventHandler","log","UITransform","error","instantiate","WebUtils","ccclass","property","dataUrl","game","ugc","EventType","UIScrollSelectHorizontal","type","tooltip","childs","isTouching","hasTouchMove","isTestX","_touchId","currentIndex","_toMoveX","dx","moveAim","discover_view","scrollChildrenCount","scrollChildrenInfo","currentCenterNode","onLoad","i","node_child","instantiate_node","getResouceImg","getChildByName","on","TOUCH_START","scrollToLeft","scrollToRight","active","content","addChild","children","length","setPosition","deltaX","getPosition","y","scrollTo","idx","anim","node","name","setCurrentPlayInfo","_checkChildX","emitEvents","selectEvents","target","SCROLL_START","index","child","x","position","Math","min","abs","scaleX","centerScale","minScale","setScale","start","_onTouch","event","touch","_startPoint","getStartLocation","evt","getLocation","_move","SCROLL_ING","_onTouchEnd","TOUCH_END","TOUCH_CANCEL","lo","getComponent","convertToNodeSpaceAR","mx","ceil","event1","SCROLL_END","max","minidx","dt","update","Number","isNaN","stepx","scrollSpeed","lx","round","tox","cx","scrolling"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, CCInteger, CCFloat, EventHandler, log, UITransform, error, instantiate, sp, math } from \"cc\";\r\nimport WebUtils from \"../common/WebUtils\";\r\nimport { drawView } from \"../draw/drawView\";\r\nimport { discoverView } from \"./discoverView\";\r\nconst { ccclass, property } = _decorator;\r\n\r\nconst dataUrl = {\r\n\tgame:[\r\n\t\t'images/avatar/cat',\r\n\t\t'images/avatar/btrump',\r\n\t\t'images/avatar/cat',\r\n\t],\r\n\tugc:[\r\n\t\t'images/avatar/ugc'\r\n\t]\r\n}\r\n\r\nexport enum EventType {\r\n\tSCROLL_START,\r\n\tSCROLL_ING,\r\n\tSCROLL_END\r\n}\r\n\r\n@ccclass('UIScrollSelectHorizontal')\r\nexport class UIScrollSelectHorizontal extends Component {\r\n\r\n\tpublic static EventType = EventType;\r\n\t@property(Node)\r\n\tcontent: Node = null;\r\n\t@property({\r\n\t\ttype: CCInteger,\r\n\t\ttooltip: '单个控件之间的距离'\r\n\t})\r\n\tdeltaX: number = 100 //x间隔距离\r\n\t@property({\r\n\t\ttype: CCFloat,\r\n\t\ttooltip: '中心点的缩放比例'\r\n\t})\r\n\tcenterScale: number = 1.0\r\n\t@property({\r\n\t\ttype: CCFloat,\r\n\t\ttooltip: '边缘点的缩放比例'\r\n\t})\r\n\tminScale: number = 1.0\r\n\t@property({\r\n\t\ttype: CCFloat,\r\n\t\ttooltip: '滚动时的速度'\r\n\t})\r\n\tscrollSpeed: number = 300;\r\n\t@property({\r\n\t\ttype: EventHandler,\r\n\t\ttooltip: \"选择后的回调\"\r\n\t})\r\n\tselectEvents: Array<EventHandler> = [];\r\n\r\n\t@property({\r\n\t\ttype: Node,\r\n\t\ttooltip: '初始化的child'\r\n\t})\r\n\tinstantiate_node: Node = null;\r\n\r\n\tprivate childs: Array<Node> = [];\r\n\tprivate isTouching: boolean = false;\r\n\tprivate hasTouchMove: boolean = false;\r\n\tprivate isTestX: boolean = false;\r\n\tprivate _touchId: any = null;\r\n\tpublic currentIndex: number = 0;\r\n\tprivate _toMoveX: number = 1; //移动方向\r\n\tprivate dx: number = 0;\r\n\tprivate moveAim: number = 0;\r\n\tdiscover_view: discoverView\r\n\r\n\tscrollChildrenCount: number\r\n\tscrollChildrenInfo: {\r\n\t\tdesc: string;\r\n\t\thot: number;\r\n\t\tid: number;\r\n\t\ticon: string;\r\n\t\tname: string;\r\n\t\tposition: number;\r\n\t\tsort: number;\r\n\t\ttags: string[];\r\n\t\ttype: number;\r\n\t\turl: string;\r\n\t  }[]\r\n\tcurrentCenterNode: number = 0;\r\n\r\n\tonLoad() {\r\n\t\t//this.scrollChildrenInfo[0].type === 1 && (this.scrollChildrenInfo = [this.scrollChildrenInfo[1], this.scrollChildrenInfo[0]])\r\n\t\tfor (var i = 0; i < this.scrollChildrenCount; i++) {\r\n\t\t\tconst node_child = instantiate(this.instantiate_node)\r\n\t\t\t//WebUtils.getRemoteImg(this.scrollChildrenInfo[i].icon,node_child.getChildByName('icon'))\r\n\t\t\tif(this.scrollChildrenInfo[i].type === 1){\r\n\r\n\t\t\t\t\tWebUtils.getResouceImg(dataUrl.game[i],node_child.getChildByName('icon'))\r\n\r\n\t\t\t\t\tWebUtils.getResouceImg(dataUrl.game[i],node_child.getChildByName('icon'))\r\n\t\t\t\t\tif(i === 0){\r\n\t\t\t\t\t\tnode_child.on(Node.EventType.TOUCH_START, ()=>{\r\n\t\t\t\t\t\t\tthis.scrollToLeft()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(i === 1){\r\n\t\t\t\t\t\tnode_child.on(Node.EventType.TOUCH_START, ()=>{\r\n\t\t\t\t\t\t\tthis.scrollToRight()\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\tWebUtils.getResouceImg(dataUrl.ugc[i],node_child.getChildByName('icon'))\r\n\t\t\t}\r\n\t\t\tnode_child.active = true\r\n\t\t\tthis.content.addChild(node_child)\r\n\t\t}\r\n\t\tthis.childs = [];\r\n\t\tfor (var i = 0; i < this.content.children.length; i++) {\r\n\t\t\tthis.childs[i] = this.content.children[i];\r\n\t\t\tthis.childs[i].setPosition(this.deltaX * (i - 1), this.childs[i].getPosition().y);\r\n\t\t\tlog(\"第\" + i + \"个预制体\" + \"，坐标为:\" + this.childs[i].getPosition());\r\n\t\t}\r\n\t\tthis.isTouching = false\r\n\t\tthis.hasTouchMove = false\r\n\t\tthis.isTestX = false;\r\n\t\tthis._touchId = null;\r\n\t\t// this.currentIndex = 0;\r\n\t\tthis.scrollTo(0, false);\r\n\t\t//this.scrollChildrenInfo[i].type === 1 && this.scrollToLeft()\r\n\t\tthis.scrollToLeft()\r\n\t}\r\n\t/** 滚动到指定节点 \r\n\t * @param anim 是否带移动动画\r\n\t*/\r\n\tscrollTo(idx: number, anim: boolean = true) {\r\n\t\tif (idx < 0 && idx >= this.childs.length) {\r\n\t\t\treturn error(this.node.name + '->移动超出边界面')\r\n\t\t}\r\n\t\tthis.currentCenterNode = idx\r\n\t\tthis.currentIndex = idx;\r\n\t\tthis.discover_view.setCurrentPlayInfo(this.scrollChildrenInfo[this.currentIndex])\r\n\t\tthis.moveAim = idx;\r\n\t\tif (!anim) {\r\n\t\t\tfor (var i = 0; i < this.childs.length; i++) {\r\n\t\t\t\tthis._checkChildX(this.childs[i], (i - idx) * this.deltaX)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.isTestX = true\r\n\t\t\tComponent.EventHandler.emitEvents(this.selectEvents, {\r\n\t\t\t\ttarget: this,\r\n\t\t\t\ttype: EventType.SCROLL_START,\r\n\t\t\t\tindex: this.currentIndex\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t/** 向左滚一个点 */\r\n\tscrollToLeft() {\r\n\t\tthis._toMoveX = 1\r\n\t\tthis.scrollChildrenInfo.length >= 2 && this.scrollTo(1)\r\n\t\t//this.scrollTo((this.currentIndex - 1 + this.childs.length) % this.childs.length)\r\n\t}\r\n\r\n\t/** 向左滚一个点 */\r\n\tscrollToRight() {\r\n\t\tthis._toMoveX = -1\r\n\t\tthis.scrollTo(0)\r\n\t\t//this.scrollTo((this.currentIndex + 1 + this.childs.length) % this.childs.length)\r\n\t}\r\n\r\n\t_checkChildX(child, x) {\r\n\t\tif (x > this.childs.length / 2 * this.deltaX) {\r\n\t\t\tx -= this.childs.length * this.deltaX\r\n\t\t} else if (x < -this.childs.length / 2 * this.deltaX) {\r\n\t\t\tx += this.childs.length * this.deltaX\r\n\t\t}\r\n\t\tchild.setPosition(x, child.position.y);\r\n\t\tlet dx = Math.min(Math.abs(x), this.deltaX)\r\n\t\tlet scaleX = (1 - dx / this.deltaX) * (this.centerScale - this.minScale) + this.minScale;\r\n\t\tchild.setScale(scaleX, scaleX);\r\n\t}\r\n\r\n\tstart() {\r\n\t\tif(this.scrollChildrenInfo[0].type === 1){\r\n\t\t\t// this.content.on(Node.EventType.TOUCH_START, this._onTouch, this);\r\n\t\t\t// this.content.on(Node.EventType.TOUCH_MOVE, this._onTouch, this);\r\n\t\t\t// this.content.on(Node.EventType.TOUCH_END, this._onTouchEnd, this);\r\n\t\t\t// this.content.on(Node.EventType.TOUCH_CANCEL, this._onTouchEnd, this);\r\n\t\t}\r\n\r\n\t}\r\n\t_onTouch(event) {\r\n\t\tif (this._touchId != null && (event.touch._startPoint.x != this._touchId._startPoint.x) && (event.touch._startPoint.y != this._touchId._startPoint.y)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (event.type == Node.EventType.TOUCH_START) {\r\n\t\t\tthis.isTouching = true;\r\n\t\t\tthis.hasTouchMove = false\r\n\t\t\tthis.isTestX = false;\r\n\t\t\tthis._touchId = event.touch;\r\n\t\t\tthis.dx = event.getStartLocation().x;\r\n\t\t\tlog(\"触碰\", event.getStartLocation())\r\n\t\t\tlet evt = {\r\n\t\t\t\ttarget: this,\r\n\t\t\t\ttype: EventType.SCROLL_START,\r\n\t\t\t\tindex: this.currentIndex\r\n\t\t\t}\r\n\t\t\tComponent.EventHandler.emitEvents(this.selectEvents, evt);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.hasTouchMove = true;\r\n\t\tvar dx = event.getLocation().x - this.dx\r\n\t\tthis._move(dx);\r\n\t\tthis.dx = event.getLocation().x\r\n\t\tvar evt = {\r\n\t\t\ttarget: this,\r\n\t\t\ttype: EventType.SCROLL_ING,\r\n\t\t\tdx: this.dx\r\n\t\t}\r\n\t\tComponent.EventHandler.emitEvents(this.selectEvents, evt);\r\n\t}\r\n\t_onTouchEnd(event) {\r\n\t\tif (this._touchId != null && (event.touch._startPoint.x != this._touchId._startPoint.x) && (event.touch._startPoint.y != this._touchId._startPoint.y)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.isTouching = false;\r\n\t\tif (event.type == Node.EventType.TOUCH_END || event.type == Node.EventType.TOUCH_CANCEL) {\r\n\t\t\tthis._touchId = null;\r\n\t\t}\r\n\t\tlet lo = this.node.getComponent(UITransform).convertToNodeSpaceAR(event.getLocation())\r\n\t\tif (!this.hasTouchMove) {\r\n\r\n\t\t\tlet mx = Math.ceil((lo.x - this.deltaX / 2) / this.deltaX)\r\n\t\t\tif (mx === 0) {\r\n\t\t\t\tvar event1 = {\r\n\t\t\t\t\ttarget: this,\r\n\t\t\t\t\ttype: EventType.SCROLL_END,\r\n\t\t\t\t\tindex: this.currentIndex\r\n\t\t\t\t}\r\n\t\t\t\tComponent.EventHandler.emitEvents(this.selectEvents, event1);\r\n\t\t\t} else {\r\n\t\t\t\tthis.moveAim = (this.currentIndex + mx + this.childs.length) % this.childs.length\r\n\t\t\t\tthis._toMoveX = mx > 0 ? -1 : 1\r\n\t\t\t\tthis.isTestX = true;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet max = this.deltaX;\r\n\t\tlet minidx = 0\r\n\t\tfor (let i = 0; i < this.childs.length; i++) {\r\n\t\t\tif (Math.abs(this.childs[i].position.x) <= max) {\r\n\t\t\t\tmax = Math.abs(this.childs[i].position.x)\r\n\t\t\t\tminidx = i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.moveAim = minidx\r\n\t\tthis._toMoveX = this.childs[minidx].position.x >= 0 ? -1 : 1\r\n\t\tthis.isTestX = true;\r\n\t}\r\n\t_move(dt) {\r\n\t\tfor (var i = 0; i < this.childs.length; i++) {\r\n\t\t\tthis._checkChildX(this.childs[i], this.childs[i].position.x + dt)\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(dt) {\r\n\t\tif (this.isTouching || !this.isTestX || Number.isNaN(this.moveAim)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar stepx = this._toMoveX * dt * this.scrollSpeed\r\n\t\tlet lx = this.childs[this.moveAim].position.x\r\n\r\n\t\t//!2个child 先这么写过😧\r\n\t\tif(Math.abs(this.childs[this.currentCenterNode].getPosition().x) <= 20){\r\n\t\t\treturn\r\n\t\t}\r\n\t\tfor (var i = 0; i < this.childs.length; i++) {\r\n\t\t\tthis._checkChildX(this.childs[i], this.childs[i].position.x + stepx)\r\n\t\t}\r\n\r\n\t\tvar x = this.childs[0].position.x;\r\n\t\tvar idx = Math.round(x / this.deltaX);\r\n\t\tvar tox = this.deltaX * idx;\r\n\t\tlet cx = this.childs[this.moveAim].position.x\r\n\t\t//!2个child 先这么写过😧\r\n\t\t// if (lx * cx < 0 && Math.abs(cx) < this.deltaX) {\r\n\t\t// \tthis.isTestX = false;\r\n\t\t// \tfor (let i = 0; i < this.childs.length; i++) {\r\n\t\t// \t\tif (Math.abs(this.childs[i].position.x) <= Math.abs(stepx)) {\r\n\t\t// \t\t\tthis.currentIndex = i;\r\n\t\t// \t\t\tthis.discover_view.setCurrentPlayInfo(this.scrollChildrenInfo[this.currentIndex])\r\n\t\t// \t\t\tbreak;\r\n\t\t// \t\t}\r\n\t\t// \t}\r\n\t\t// \tfor (var i = 0; i < this.childs.length; i++) {\r\n\t\t// \t\tthis._checkChildX(this.childs[i], this.childs[i].position.x + tox - x)\r\n\t\t// \t}\r\n\t\t// \tvar event = {\r\n\t\t// \t\ttarget: this,\r\n\t\t// \t\ttype: EventType.SCROLL_END,\r\n\t\t// \t\tindex: this.currentIndex\r\n\t\t// \t}\r\n\t\t// \tComponent.EventHandler.emitEvents(this.selectEvents, event);\r\n\t\t// }\r\n\t}\r\n\r\n\tscrolling() {\r\n\t\tlog(\"scrolling\");\r\n\t}\r\n}\r\n"]}