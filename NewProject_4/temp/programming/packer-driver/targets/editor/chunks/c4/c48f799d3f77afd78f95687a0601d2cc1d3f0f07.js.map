{"version":3,"sources":["file:///Users/feiwang/tg_cocos/NewProject_4/assets/resources/scripts/discover/discoverView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","basePageView","UIScrollSelectHorizontal","ccclass","property","discoverView_arrow","discoverView","shift_btns","currentGameScrollOffset","current_game_info","current_ugc_info","start","btn_shift_game","btn_shift_ugc","localStorage","getItem","arrow","active","arrow_s","update","deltaTime","shiftCurrentPlayType","btn","data","forEach","node","getChildByName","currentTarget","game_part","ugc_part","initGameViews","gameList","initScrollPrefabs","initUgcViews","ugcList","list","father_node","hp","scroll_node","getComponent","scrollChildrenCount","length","scrollChildrenInfo","discover_view","addChild","setPosition","type","setCurrentPlayInfo","play","index","info","game_description","string","desc","game_tittle","name","ugc_description","ugc_tittle","openCurrentPlayUrl","event","gameInitData","URLSearchParams","window","location","search","get","Telegram","WebApp","initData","openTelegramLink","url","initDataUnsafe","user","id","tryInstantView","urlComponent","decodeURIComponent","atob","tgId","JSON","parse","split","btoa","console","log","markArrow","setItem","currentPageClose"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  EventTouch,\n  instantiate,\n  Label,\n  Node,\n  Prefab,\n  ScrollView,\n  Sprite,\n  UITransform,\n  Vec2,\n} from \"cc\";\nimport { basePageView } from \"../common/basePageView\";\nimport WebUtils from \"../common/WebUtils\";\nimport { UIScrollSelectHorizontal } from \"./UIScrollSelectHorizontal\";\nconst { ccclass, property } = _decorator;\n\nconst discoverView_arrow = 'discoverView_arrow'\n\n@ccclass(\"discoverView\")\nexport class discoverView extends basePageView {\n  @property(Node)\n  btn_shift_game: Node = null;\n\n  @property(Node)\n  btn_shift_ugc: Node = null;\n\n  @property(Node)\n  game_part: Node = null;\n\n  @property(Node)\n  ugc_part: Node = null;\n\n  @property(Prefab)\n  scroll_node: Prefab = null;\n\n  @property(Label)\n  game_description: Label = null;\n\n  @property(Label)\n  game_tittle: Label = null;\n\n  @property(Label)\n  ugc_description: Label = null;\n\n  @property(Label)\n  ugc_tittle: Label = null;\n\n  @property(Node)\n  arrow: Node;\n\n  @property(Node)\n  arrow_s: Node;\n\n  shift_btns: Node[] = [];\n\n  currentGameScrollOffset: any\n\n  current_game_info: {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }\n\n  current_ugc_info: {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }\n\n  start() {\n    this, (this.shift_btns = [this.btn_shift_game, this.btn_shift_ugc]);\n    if(localStorage.getItem(discoverView_arrow)){\n      this.arrow.active = false\n      this.arrow_s.active = true\n    }\n\n    // this.node.getComponent(ScrollView).scrollToBottom()\n    // this.node.getComponent(ScrollView).scrollToTop()\n    // this.game_father_node.on(Node.EventType.TOUCH_START, (event) => {\n    //     this.currentGameScrollOffset = this.game_father_node.getComponent(ScrollView).getScrollOffset()\n    // });\n\n    // this.game_father_node.on(Node.EventType.TOUCH_END, (event: EventTouch) => {\n\n    //   const startPos = event.touch.getStartLocation();\n    //   const prePos = event.touch.getPreviousLocation();\n\n\n    //   let offset;\n    //   if (startPos.x > prePos.x) {\n    //     offset = -500;\n    //   } else {\n    //     offset = 500;\n    //   }\n      \n    //   const scroll = this.game_father_node.getComponent(ScrollView);\n    //   console.log('========',scroll.getScrollOffset().x,this.currentGameScrollOffset.x )\n    //   scroll.scrollToOffset(\n    //     new Vec2(\n    //       this.currentGameScrollOffset.x + 100,\n    //       0\n    //     ),\n    //     1,\n    //     true\n    //   );\n    //   this.currentGameScrollOffset.x = this.currentGameScrollOffset.x +100 \n\n    // });\n    \n  }\n\n  update(deltaTime: number) {}\n\n  shiftCurrentPlayType(btn: EventTouch, data: string) {\n    this.shift_btns.forEach((node) => {\n      node.getChildByName(\"selected\").active = false;\n      node.getChildByName(\"selected_lable\").active = false;\n      node.getChildByName(\"unselected_lable\").active = true;\n    });\n    btn.currentTarget.getChildByName(\"selected\").active = true;\n    btn.currentTarget.getChildByName(\"selected_lable\").active = true;\n    btn.currentTarget.getChildByName(\"unselected_lable\").active = false;\n    if (data === \"game\") {\n      this.game_part.active = true;\n      this.ugc_part.active = false;\n    } else {\n      this.game_part.active = false;\n      this.ugc_part.active = true;\n    }\n  }\n\n  initGameViews(\n    gameList: {\n      desc: string;\n      hot: number;\n      id: number;\n      icon: string;\n      name: string;\n      position: number;\n      sort: number;\n      tags: string[];\n      type: number;\n      url: string;\n    }[]\n  ) {\n    this.initScrollPrefabs(gameList, this.game_part)\n  }\n\n  initUgcViews(\n    ugcList: {\n      desc: string;\n      hot: number;\n      id: number;\n      icon: string;\n      name: string;\n      position: number;\n      sort: number;\n      tags: string[];\n      type: number;\n      url: string;\n    }[]\n  ) {\n    this.initScrollPrefabs(ugcList, this.ugc_part)\n  }\n\n  initScrollPrefabs(list:  {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }[], father_node: Node){\n    let hp = instantiate(this.scroll_node);\n    hp.getComponent(UIScrollSelectHorizontal).scrollChildrenCount = list.length\n    hp.getComponent(UIScrollSelectHorizontal).scrollChildrenInfo = list\n    hp.getComponent(UIScrollSelectHorizontal).discover_view = this.node.getComponent(discoverView)\n    father_node.addChild(hp);\n    hp.setPosition(0, 0);\n    list[0].type === 1 ? this.setCurrentPlayInfo(list[1]) : this.setCurrentPlayInfo(list[0])\n    list.forEach((play, index) => {\n\n    });\n  }\n\n  setCurrentPlayInfo(info:  {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }){\n    if(info.type === 1){\n        this.game_description.string = info.desc\n        this.game_tittle.string = info.name\n        this.current_game_info = info\n    }else{\n        this.ugc_description.string = info.desc\n        this.ugc_tittle.string = info.name\n        this.current_ugc_info = info\n    }\n  }\n\n  openCurrentPlayUrl(event, data:string){\n    const gameInitData = new URLSearchParams(window.location.search).get(\"gameData\");\n    if(data === '1'){\n      if(window?.Telegram?.WebApp?.initData){\n        window.Telegram.WebApp.openTelegramLink(`${this.current_game_info.url}?startapp=TG${window?.Telegram?.WebApp?.initDataUnsafe?.user?.id}`, { tryInstantView: true });\n      }else if(gameInitData){\n        const urlComponent = decodeURIComponent(window.atob(gameInitData))\n        const tgId = JSON.parse(decodeURIComponent(urlComponent).split('&')[1].split('=')[1]).id\n        window.Telegram.WebApp.openTelegramLink(`${this.current_game_info.url}?startapp=TG${tgId}`, { tryInstantView: true });\n      }\n    }else{\n\n        if(window?.Telegram?.WebApp?.initData){\n          window.Telegram.WebApp.openTelegramLink(`${this.current_ugc_info.url}?startapp=${window.btoa(window?.Telegram?.WebApp?.initData)}`, { tryInstantView: true });\n        }else if(gameInitData){\n          window.Telegram.WebApp.openTelegramLink(`${this.current_ugc_info.url}?startapp=${gameInitData}`, { tryInstantView: true });\n        }\n        \n        console.log('====Telegram', `${this.current_ugc_info.url}?startapp=${window.btoa(window?.Telegram?.WebApp?.initData)}`)\n    }\n  }\n\n  markArrow(){\n    localStorage.setItem(discoverView_arrow, 'discoverView_arrow')\n    this.arrow.active = false\n    this.arrow_s.active = true\n  }\n\n  currentPageClose() {}\n}"]}