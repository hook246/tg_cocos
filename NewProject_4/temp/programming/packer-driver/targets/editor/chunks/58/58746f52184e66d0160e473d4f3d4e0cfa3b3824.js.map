{"version":3,"sources":["file:///Users/feiwang/tg_cocos/NewProject_4/assets/resources/scripts/draw/drawModel.ts"],"names":["_decorator","basePageModel","drawView","GlobalData","PromiseUtils","ccclass","property","local","local_token","drawLuckUrls","claim","isProduction","config","info","join","tickets_usdt","walletUrls","bindWallet","unbindWallet","queryBindWallet","drawModel","drawPage","account","tonConnectUI","timer_add","start","window","bindUxuyWallet","view","getComponent","console","log","manifest","TON_CONNECT_UI","TonConnectUI","manifestUrl","uiPreferences","searchConfig","getDrawLuckInfo","joinDrawLucy","getUserTicketsUsdtInfo","setTimerCount","index","Math","round","drawLuckyInfo","drawTime","wait","current_time","formatTimestamp","timer","string","setJoinBtnUseAble","update","deltaTime","bindTonWallet","connected","disconnect","onStatusChange","walletAndwalletInfo","wallet_address","controlConnectWalletBtnsVisible","home","getChildByName","active","walletInfo","axios","post","walletAddress","address","walletChain","chain","headers","token","setWalletInfo","openModal","timestamp","date","Date","now","years","getFullYear","months","getMonth","weeks","floor","getTime","days","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","initData","getWalletInfo","ticketsInfo","setCurrentTicketsUsdtCount","data","uxuyethereum","_account","chainName","uxuyWalletConnect","error","unBindWallet","controlUnbindBtnVisible","controlBindBtnVisible","code","copyAddress","navigator","clipboard","writeText","then","Telegram","WebApp","showPopup","title","message","buttons","id","text","type","buttonId","catch","err","get","drawInfo","setDrawLuckInfo","claimReward","drawId","reward","closeDrawLuckRewardInfo"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from \"cc\";\nimport { basePageModel } from \"../common/basePageModel\";\nimport { AxiosResponse } from \"../login/loginModel\";\nimport { GlobalConfig } from \"../home/GlobalConfig\";\nimport { drawView, QueryDrawRespDTO, QueryDrawRespDTOData } from \"./drawView\";\nimport GlobalData from '../home/GloabalClass'\nimport { PromiseUtils } from \"../common/PromiseUtils\";\nconst { ccclass, property } = _decorator;\n\nconst local = false\nconst local_token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dpblR5cGUiOiJQQVJUSUNMRSIsInVzZXJJZCI6IjE4MjgwMjA3NzY3NzU4NDc5MzYiLCJpYXQiOjE3Mjg5ODgxNDV9.qhV94PwKEKOJI1CtuLpLCqtJq78MOB-6AuHexqRvYTg'\n\nexport interface ticketsUsdt {\n  data:{\n    \"tiket\": number,\n    \"usdt\": number\n  }\n}\n\ndeclare global {\n  interface Window {\n    axios: {\n      post<T = any, R = AxiosResponse<T>, D = any>(\n        url: string,\n        data?: D,\n        config?: any\n      ): Promise<R>;\n      get<T = any, R = AxiosResponse<T>, D = any>(url: string, config?: any): Promise<R>;\n    };\n    startCanvas: any;\n    uxuyethereum: any;\n    uxuyWalletConnect: any;\n\n    bindUxuyWallet\n    TON_CONNECT_UI\n\n  }\n}\n\n// export const drawLuckUrls = {\n//   claim: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/claim\" : \"http://192.168.184.19:9002/hall/api/draw/claim\",\n//   config: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/config\":\n//     \"http://192.168.184.19:9002/hall/api/draw/config\",\n//   info: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/info\":\n//     \"http://192.168.184.19:9002/hall/api/draw/info\",\n//   join:GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/join\":\n//   \"http://192.168.184.19:9002/hall/api/draw/join\",\n//   tickets_usdt: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/user/info\":\n//   \"http://192.168.184.19:9002/hall/api/user/info\",\n// }\n\nexport const drawLuckUrls = {\n  claim: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/claim\" : \"https://api.infinitytest.cc/hall/api/draw/claim\",\n  config: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/config\":\n    \"https://api.infinitytest.cc/hall/api/draw/config\",\n  info: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/info\":\n    \"https://api.infinitytest.cc/hall/api/draw/info\",\n  join:GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/join\":\n  \"https://api.infinitytest.cc/hall/api/draw/join\",\n  tickets_usdt: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/user/info\":\n  \"https://api.infinitytest.cc/hall/api/user/info\",\n}\n\nexport const walletUrls = {\n  bindWallet: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/user/info/edit/bindWallet\" : \"https://api.infinitytest.cc/api/v1/user/info/edit/bindWallet\",\n  unbindWallet: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/user/info/edit/unbindWallet\":\n    \"https://api.infinitytest.cc/api/v1/user/info/edit/unbindWallet\",\n  queryBindWallet: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/user/info/queryBindWallet\":\n    \"https://api.infinitytest.cc/api/v1/user/info/queryBindWallet\",\n};\n\nexport interface BindWalletData {\n  walletAddress: string;\n  walletChain: string;\n}\n\nexport interface BindWalletResponse {\n  code: string;\n  message: string;\n}\n\nexport interface UnbindWalletData {}\n\nexport interface UnbindWalletResponse {\n  code: string;\n  message: string;\n}\n\nexport interface QueryBindWalletData {}\n\nexport interface QueryBindWalletResponse {\n  code: string;\n  data: {\n    walletAddress: string;\n    walletChain: string;\n  };\n  message: string;\n}\n\n@ccclass(\"drawModel\")\nexport class drawModel extends basePageModel {\n  drawPage: drawView\n\n  account;\n  tonConnectUI;\n\n  timer_add = 0\n\n  async start() {\n    window.bindUxuyWallet = this.bindUxuyWallet\n    this.drawPage = this.view.getComponent(drawView)\n\n    console.log(\"INIT the tonconnect \", this.tonConnectUI);\n    //提供一个manifest的json文件记录一些标题图标等数据用于UI连接时的展示\n    const manifest = \"https://catoss.s3.ap-southeast-1.amazonaws.com/telegram/manifest.json\";\n    console.log(manifest);\n    //获得TON_CONNECT_UI的实例\n    this.tonConnectUI = new window.TON_CONNECT_UI.TonConnectUI({\n      manifestUrl: manifest,\n      uiPreferences: {\n        //这里可以配置主题\n        // theme: TON_CONNECT_UI.THEME.DARK,\n      },\n    });\n\n    window['searchConfig'] = this.searchConfig\n    window['getDrawLuckInfo'] = this.getDrawLuckInfo\n    window['joinDrawLucy'] = this.joinDrawLucy\n    window['usdtInfo'] = this.getUserTicketsUsdtInfo\n    //this.claimReward\n    // if(this.tonConnectUI.connected) {\n    //     //断开连接重新加载\n    //     console.log(\"Disconnect for connection reload\")\n    //     await this.tonConnectUI.disconnect();\n    // }\n  }\n  \n  async setTimerCount(){\n    for(let index = Math.round(this.drawPage.drawLuckyInfo.drawTime / 1000); index > 0; index--){\n      await PromiseUtils.wait(1000)\n      const current_time = this.formatTimestamp(index * 1000)\n      this.drawPage.timer.string = current_time\n      if(index === 0){\n      await this.getDrawLuckInfo()\n      }else if(this.drawPage.drawLuckyInfo.drawTime <= 5){\n        this.drawPage.setJoinBtnUseAble(false)\n      }\n    }\n  }\n\n  async update(deltaTime: number) {\n    if(!this.drawPage.drawLuckyInfo?.drawTime){\n      return\n    }\n    this.timer_add = this.timer_add + deltaTime\n    if(this.timer_add >= 1){\n      this.drawPage.drawLuckyInfo.drawTime = this.drawPage.drawLuckyInfo.drawTime - 1000\n      if(this.drawPage.drawLuckyInfo.drawTime <= 5000 && this.drawPage.drawLuckyInfo.drawTime > 0){\n        this.drawPage.setJoinBtnUseAble(false)\n      }else if(this.drawPage.drawLuckyInfo.drawTime <= 0){\n        // const drawLuckyInfo = await this.getDrawLuckInfo()\n        // this.drawPage.setDrawLuckInfo(drawLuckyInfo.data.data)\n        // this.drawPage.showDrawLuckRewardInfo(drawLuckyInfo.data.data)\n\n      }else{\n        \n      }\n      const current_time = this.formatTimestamp(this.drawPage.drawLuckyInfo.drawTime)\n      this.drawPage.timer.string = current_time\n      this.timer_add = 0\n    }\n  }\n\n  async bindTonWallet() {\n    if(this.tonConnectUI.connected){\n      await this.tonConnectUI.disconnect();\n    }\n    this.tonConnectUI.onStatusChange(async (walletAndwalletInfo) => {\n      //连接状态改变监听事件\n      if(GlobalData.wallet_address){\n        return\n      }\n      console.log(\"change : \", walletAndwalletInfo);\n      this.account = walletAndwalletInfo;\n      this.drawPage.controlConnectWalletBtnsVisible(false)\n      this.drawPage.home.getChildByName('tap_btns').active = true\n      const walletInfo = await window.axios.post<BindWalletResponse>(\n        walletUrls.bindWallet,{\n          walletAddress: walletAndwalletInfo.account.address,\n          walletChain: walletAndwalletInfo.account.chain,\n        },{\n          headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n            }\n        }\n      );\n      this.drawPage.setWalletInfo(walletAndwalletInfo.account.address)\n    });\n    await this.tonConnectUI.openModal();\n  }\n\n    //设置当前的倒计时\n    formatTimestamp(timestamp: number): string {\n      const date = new Date(timestamp);\n      const now = new Date();\n      let years = now.getFullYear() - date.getFullYear();\n      let months = now.getMonth() - date.getMonth();\n      let weeks = Math.floor((now.getTime() - date.getTime()) / (7 * 24 * 60 * 60 * 1000));\n      let days = now.getDate() - date.getDate();\n      let hours = now.getHours() - date.getHours();\n      let minutes = now.getMinutes() - date.getMinutes();\n      let seconds = now.getSeconds() - date.getSeconds();\n    \n      // 处理跨日的情况\n      if (seconds < 0) {\n        seconds += 60;\n        minutes--;\n      }\n      if (minutes < 0) {\n        minutes += 60;\n        hours--;\n      }\n      if (hours < 0) {\n        hours += 24;\n        days--;\n      }\n      if (days < 0) {\n        days += 7;\n        weeks--;\n      }\n    \n      // 调整年份和月份，因为年份和月份的计算可能不准确\n      if (months < 0 || (months === 0 && (days < 0 || (days === 0 && hours < 0)))) {\n        years--;\n        months += 12;\n      }\n    \n      return `${years} 年 ${months + 1} 月 ${weeks} 周 ${days} 天 ${hours} 时 ${minutes} 分 ${seconds} 秒`;\n    }\n\n  async initData(){\n    const walletInfo = await this.getWalletInfo()\n    if(walletInfo?.walletAddress){\n      this.drawPage.setWalletInfo(walletInfo?.walletAddress)\n    }\n    const ticketsInfo = await this.getUserTicketsUsdtInfo()\n    this.drawPage.setCurrentTicketsUsdtCount(ticketsInfo.data)\n    await this.getDrawLuckInfo()\n\n  }\n\n  async bindUxuyWallet() {\n    try {\n      this.drawPage.controlConnectWalletBtnsVisible(false)\n      this.drawPage.home.getChildByName('tap_btns').active = true\n      let walletAddress\n      let walletChain\n      if(window.uxuyethereum._account.address){\n        walletAddress = window.uxuyethereum._account.address\n        walletChain = window.uxuyethereum._account.chainName\n      }else{\n        await window.uxuyWalletConnect()\n        walletAddress = window.uxuyethereum._account.address\n        walletChain = window.uxuyethereum._account.chainName\n      }\n      console.log('========',walletAddress, walletChain)\n      const walletInfo = await window.axios.post<BindWalletResponse>(\n        walletUrls.bindWallet,{\n          walletAddress: walletAddress,\n          walletChain: walletChain,\n        },{\n          headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n            }\n        }\n      );\n      this.drawPage.setWalletInfo(walletAddress)\n\n    } catch (error) {\n      \n    }\n  }\n\n  async unBindWallet() {\n    const walletInfo = await window.axios.post<UnbindWalletResponse>(\n      walletUrls.unbindWallet\n    ,{},{\n        headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n          }\n    });\n    this.drawPage.controlUnbindBtnVisible(false)\n    this.drawPage.controlBindBtnVisible(true)\n    GlobalData.wallet_address = null\n    return walletInfo?.data?.code;\n  }\n\n  async getWalletInfo() {\n    const walletInfo = await window.axios.post<QueryBindWalletResponse>(\n      walletUrls.queryBindWallet\n    ,{},{\n        headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n          }\n    });\n    return walletInfo?.data?.data;\n  }\n\n  async copyAddress(){\n    navigator.clipboard.writeText(this.drawPage.address.string).then(function() {\n      window.Telegram.WebApp.showPopup({\n        title: 'Copy Success', // 弹出窗口的标题\n        message: 'copy address success！', // 弹出窗口的消息内容\n        buttons: [\n          { id: 'btn2', text: 'Button 2', type: 'ok' }, // 'type' 可以是 'ok', 'close', 'cancel', 'default', 'destructive'\n          { id: 'btn3', text: 'Button 3', type: 'cancel' }\n        ]\n      }, (buttonId) => {\n        // 弹出窗口关闭时的回调函数\n        if (buttonId) {\n          console.log('User pressed button:', buttonId);\n        } else {\n          console.log('Popup was closed without pressing a button');\n        }\n      });\n    }).catch(err => {\n      window.Telegram.WebApp.showPopup({\n        title: 'Copy failed', // 弹出窗口的标题\n        message: 'copy address failed', // 弹出窗口的消息内容\n        buttons: [\n          { id: 'btn2', text: 'Button 2', type: 'ok' }, // 'type' 可以是 'ok', 'close', 'cancel', 'default', 'destructive'\n          { id: 'btn3', text: 'Button 3', type: 'cancel' }\n        ]\n      }, (buttonId) => {\n        // 弹出窗口关闭时的回调函数\n        if (buttonId) {\n          console.log('User pressed button:', buttonId);\n        } else {\n          console.log('Popup was closed without pressing a button');\n        }\n      });\n    });\n  }\n\n  async searchConfig(){\n    const config = await window.axios.get(drawLuckUrls.config, {\n      headers: { \n          'Authorization': `Bearer ${local ? local_token : GlobalData.token}`\n        }\n    })\n  }\n\n  async getDrawLuckInfo(){\n    const drawInfo = await window.axios.get<QueryDrawRespDTOData>(drawLuckUrls.info, {\n      headers: { \n          'Authorization': `Bearer ${local ? local_token : GlobalData.token}`\n        }\n    })\n    this.drawPage.setDrawLuckInfo(drawInfo.data.data)\n    await this.setTimerCount()\n  } \n\n  async joinDrawLucy(){\n    try {\n      const join = await window.axios.get(drawLuckUrls.join, {\n        headers: { \n            'Authorization': `Bearer ${local ? local_token : GlobalData.token}`\n          }\n      })\n      this.drawPage.setJoinBtnUseAble(false)\n    } catch (error) {\n      \n    }\n\n  }\n\n  async claimReward(drawId: string){\n    const reward = await window.axios.post<ticketsUsdt>(drawLuckUrls.claim,{\n       \"drawId\": drawId\n    }, {\n      headers: {\n          'Authorization': `Bearer ${local ? local_token : GlobalData.token}`\n        }\n    })\n    this.drawPage.setCurrentTicketsUsdtCount(reward.data)\n    this.drawPage.closeDrawLuckRewardInfo()\n  }\n\n  async getUserTicketsUsdtInfo(){\n    const info = await window.axios.get<ticketsUsdt>(drawLuckUrls.tickets_usdt, {\n      headers: {\n          'Authorization': `Bearer ${local ? local_token : GlobalData.token}`\n        }\n    })\n    return info\n  }\n}\n"]}