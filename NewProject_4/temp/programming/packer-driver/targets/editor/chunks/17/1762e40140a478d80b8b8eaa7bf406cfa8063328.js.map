{"version":3,"sources":["file:///Users/feiwang/tg_cocos/NewProject_4/assets/resources/scripts/discover/discoverView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ScrollView","basePageView","UIScrollSelectHorizontal","ccclass","property","discoverView","shift_btns","currentGameScrollOffset","current_game_info","current_ugc_info","start","btn_shift_game","btn_shift_ugc","node","getComponent","scrollToBottom","scrollToTop","update","deltaTime","shiftCurrentPlayType","btn","data","forEach","getChildByName","active","currentTarget","game_part","ugc_part","initGameViews","gameList","initScrollPrefabs","initUgcViews","ugcList","list","father_node","hp","scroll_node","scrollChildrenCount","length","scrollChildrenInfo","discover_view","addChild","setPosition","setCurrentPlayInfo","play","index","info","type","game_description","string","desc","game_tittle","name","ugc_description","ugc_tittle","openCurrentPlayUrl","event","window","Telegram","WebApp","openTelegramLink","url","initDataUnsafe","user","id","tryInstantView","btoa","initData","console","log","currentPageClose"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  EventTouch,\n  instantiate,\n  Label,\n  Node,\n  Prefab,\n  ScrollView,\n  Sprite,\n  UITransform,\n  Vec2,\n} from \"cc\";\nimport { basePageView } from \"../common/basePageView\";\nimport WebUtils from \"../common/WebUtils\";\nimport { UIScrollSelectHorizontal } from \"./UIScrollSelectHorizontal\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"discoverView\")\nexport class discoverView extends basePageView {\n  @property(Node)\n  btn_shift_game: Node = null;\n\n  @property(Node)\n  btn_shift_ugc: Node = null;\n\n  @property(Node)\n  game_part: Node = null;\n\n  @property(Node)\n  ugc_part: Node = null;\n\n  @property(Prefab)\n  scroll_node: Prefab = null;\n\n  @property(Label)\n  game_description: Label = null;\n\n  @property(Label)\n  game_tittle: Label = null;\n\n  @property(Label)\n  ugc_description: Label = null;\n\n  @property(Label)\n  ugc_tittle: Label = null;\n\n  shift_btns: Node[] = [];\n\n  currentGameScrollOffset: any\n\n  current_game_info: {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }\n\n  current_ugc_info: {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }\n\n  start() {\n    this, (this.shift_btns = [this.btn_shift_game, this.btn_shift_ugc]);\n    this.node.getComponent(ScrollView).scrollToBottom()\n    this.node.getComponent(ScrollView).scrollToTop()\n    // this.game_father_node.on(Node.EventType.TOUCH_START, (event) => {\n    //     this.currentGameScrollOffset = this.game_father_node.getComponent(ScrollView).getScrollOffset()\n    // });\n\n    // this.game_father_node.on(Node.EventType.TOUCH_END, (event: EventTouch) => {\n\n    //   const startPos = event.touch.getStartLocation();\n    //   const prePos = event.touch.getPreviousLocation();\n\n\n    //   let offset;\n    //   if (startPos.x > prePos.x) {\n    //     offset = -500;\n    //   } else {\n    //     offset = 500;\n    //   }\n      \n    //   const scroll = this.game_father_node.getComponent(ScrollView);\n    //   console.log('========',scroll.getScrollOffset().x,this.currentGameScrollOffset.x )\n    //   scroll.scrollToOffset(\n    //     new Vec2(\n    //       this.currentGameScrollOffset.x + 100,\n    //       0\n    //     ),\n    //     1,\n    //     true\n    //   );\n    //   this.currentGameScrollOffset.x = this.currentGameScrollOffset.x +100 \n\n    // });\n    \n  }\n\n  update(deltaTime: number) {}\n\n  shiftCurrentPlayType(btn: EventTouch, data: string) {\n    this.shift_btns.forEach((node) => {\n      node.getChildByName(\"selected\").active = false;\n      node.getChildByName(\"selected_lable\").active = false;\n      node.getChildByName(\"unselected_lable\").active = true;\n    });\n    btn.currentTarget.getChildByName(\"selected\").active = true;\n    btn.currentTarget.getChildByName(\"selected_lable\").active = true;\n    btn.currentTarget.getChildByName(\"unselected_lable\").active = false;\n    if (data === \"game\") {\n      this.game_part.active = true;\n      this.ugc_part.active = false;\n    } else {\n      this.game_part.active = false;\n      this.ugc_part.active = true;\n    }\n  }\n\n  initGameViews(\n    gameList: {\n      desc: string;\n      hot: number;\n      id: number;\n      icon: string;\n      name: string;\n      position: number;\n      sort: number;\n      tags: string[];\n      type: number;\n      url: string;\n    }[]\n  ) {\n    this.initScrollPrefabs(gameList, this.game_part)\n  }\n\n  initUgcViews(\n    ugcList: {\n      desc: string;\n      hot: number;\n      id: number;\n      icon: string;\n      name: string;\n      position: number;\n      sort: number;\n      tags: string[];\n      type: number;\n      url: string;\n    }[]\n  ) {\n    this.initScrollPrefabs(ugcList, this.ugc_part)\n  }\n\n  initScrollPrefabs(list:  {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }[], father_node: Node){\n    let hp = instantiate(this.scroll_node);\n    hp.getComponent(UIScrollSelectHorizontal).scrollChildrenCount = list.length\n    hp.getComponent(UIScrollSelectHorizontal).scrollChildrenInfo = list\n    hp.getComponent(UIScrollSelectHorizontal).discover_view = this.node.getComponent(discoverView)\n    father_node.addChild(hp);\n    hp.setPosition(0, 0);\n    this.setCurrentPlayInfo(list[0])\n    list.forEach((play, index) => {\n\n    });\n  }\n\n  setCurrentPlayInfo(info:  {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }){\n    if(info.type === 1){\n        this.game_description.string = info.desc\n        this.game_tittle.string = info.name\n        this.current_game_info = info\n    }else{\n        this.ugc_description.string = info.desc\n        this.ugc_tittle.string = info.name\n        this.current_ugc_info = info\n    }\n  }\n\n  openCurrentPlayUrl(event, data:string){\n    if(data === '1'){\n        window.Telegram.WebApp.openTelegramLink(`${this.current_game_info.url}?startapp=${window?.Telegram?.WebApp?.initDataUnsafe?.user?.id}`, { tryInstantView: true });\n    }else{\n        window.Telegram.WebApp.openTelegramLink(`${this.current_ugc_info.url}?startapp=${window.btoa(window?.Telegram?.WebApp?.initData)}`, { tryInstantView: true });\n        console.log('====Telegram', `${this.current_ugc_info.url}?startapp=${window.btoa(window?.Telegram?.WebApp?.initData)}`)\n    }\n  }\n\n  currentPageClose() {}\n}"]}