{"version":3,"sources":["file:///Users/feiwang/tg_cocos/NewProject_4/assets/resources/scripts/common/WebUtils.ts"],"names":["WebUtils","assetManager","SpriteFrame","Texture2D","Sprite","Node","resources","Prefab","instantiate","error","Layers","UITransform","Vec2","TAG","getRemoteImg","remoteUrl","sprite","callback","console","log","loadRemote","err","imageAsset","spriteFrame","texture","components","length","getComponent","image","resMap","getResouceImg","load","getResoucePrefab","prefab","newNode","addChild","preloadPrefab","protocal","url","indexOf","replace","loadRes","type","cb","res","message","createSprite","width","height","name","spr","layer","Enum","UI_2D","addComponent","setAnchorPoint","throttle","fn","limit","args","timeoutStream","window","setTimeout","apply","debounce","wait","clearTimeout","timeoutStack"],"mappings":"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","sourcesContent":["import {\n    assetManager,\n    ImageAsset,\n    SpriteFrame,\n    Texture2D,\n    Sprite,\n    Node,\n    resources,\n    Prefab,\n    instantiate,\n    Asset,\n    error,\n    Constructor,\n    Layers,\n    UITransform,\n    Vec2,\n  } from \"cc\";\n  export type AssetType<T = Asset> = Constructor<T>;\n\n  \n  const TAG = 'WebUtils'\n  \n  export default class WebUtils {\n  \n    public static resMap = {}\n    static timeoutStack: number;\n    static timeoutStream: number;\n  \n    /**\n     * 获取远程图片\n     * @param remoteUrl \n     * @param sprite \n     * @param callback \n     * @returns \n     */\n    public static getRemoteImg(\n      remoteUrl,\n      sprite: Node = null,\n      callback: Function = null\n    ) {\n      if(!remoteUrl || typeof(\"dd\") != \"string\"){\n        console.log(TAG, \"getRemoteImg::remoteUrl错误:\"+remoteUrl);\n        return;\n      }\n      try{\n        assetManager.loadRemote<ImageAsset>(remoteUrl,  (err, imageAsset) => {\n          const spriteFrame = new SpriteFrame();\n          const texture = new Texture2D();\n          if (!err && sprite) {\n            try {\n              if (!sprite.components.length) {\n                return;\n              }\n              (sprite.getComponent(Sprite) as any).spriteFrame = null;\n              texture.image = imageAsset;\n              spriteFrame.texture = texture;\n              if (this.resMap[remoteUrl]) {\n                sprite.getComponent(Sprite).spriteFrame = this.resMap[remoteUrl];\n              } else {\n                this.resMap[remoteUrl] = spriteFrame\n                sprite.getComponent(Sprite).spriteFrame = spriteFrame;\n              }\n            } catch (error) {\n              console.log(TAG,error)\n            }\n          }\n          if (callback) {\n            callback(err, spriteFrame);\n          }\n        });\n      }catch(err){\n        console.log(TAG,\"getRemoteImg::remoteUrl错误:\",err);\n        \n      }\n  \n    }\n  \n    public static getResouceImg(\n      remoteUrl,\n      sprite: Node = null,\n      callback: Function = null\n    ) {\n      resources.load(\n        remoteUrl + \"/spriteFrame\",\n        SpriteFrame,\n        function (err, spriteFrame) {\n          if (!err && sprite) {\n            // const spriteFrame = new SpriteFrame();\n            // spriteFrame.texture = texture;\n            try {\n              sprite.getComponent(Sprite).spriteFrame = spriteFrame;\n            } catch (error) {\n              console.log(TAG, error)\n            }\n            \n          } else {\n            console.log(TAG,\" or sprite 为空\",remoteUrl);\n          }\n          if (callback) {\n            callback(err, spriteFrame);\n          }\n        }\n      );\n    }\n  \n    public static getResoucePrefab(\n      remoteUrl,\n      sprite: Node = null,\n      callback: Function = null\n    ) {\n      resources.load(remoteUrl, Prefab, function (err, prefab) {\n        let newNode;\n        if (sprite) {\n          try {\n            newNode = instantiate(prefab);\n            sprite.addChild(newNode);\n          } catch (error) {\n           \n          }\n        } else {\n          console.log(TAG,\"sprite 为空\");\n        }\n        if (callback) {\n          callback(err, newNode);\n        }\n      });\n    }\n  \n    public static preloadPrefab(\n      remoteUrl, \n      callback: Function = null\n    ) {\n      resources.load(remoteUrl, Prefab, function (err, prefab) {\n        let newNode;\n        newNode = instantiate(prefab);\n        if (callback) {\n          callback(err, newNode);\n        }\n      });\n    }\n    public static protocal(url) {\n      if (!url) return;\n      if (url.indexOf(\"http://\") !== -1) {\n        return (url as string).replace(\"http://\",\"https://\");\n      } else {\n        if (url.indexOf(\"https://\") !== -1) {\n          return `${url}`;\n        } else {\n          return `https:${url}`;//  \"//\"\n        }\n      }\n    }\n  \n    // public static isMobile(){\n    //   const userAgent = navigator.userAgent || navigator.vendor || window.opera;\n    //   if (/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent)) {\n    //     return true\n    //   }else{\n    //     return false\n    //   } \n    // }\n  \n  \n    public static loadRes<T extends Asset>(url: string, type: AssetType<T> | null, cb?: any) {\n      if(type){\n          resources.load(url, type, (err, res) => {\n              if (err) {\n                  error(err.message || err);\n                  if (cb) {\n                      cb(err, res);\n                  }\n  \n                  return;\n              }\n  \n              if (cb) {\n                  cb(err, res);\n              }\n          });\n      } else {\n          resources.load(url, (err, res) => {\n              if (err) {\n                  error(err.message || err);\n                  if (cb) {\n                      cb(err, res as T);\n                  }\n  \n                  return;\n              }\n  \n              if (cb) {\n                  cb(err, res as T);\n              }\n          });\n      }\n  }\n  public static createSprite(width:number = 10,height:number = 10,name?:string){\n    let spr:Node = new Node();\n    spr.layer = Layers.Enum.UI_2D;//Layer 设置要准确 ui_2d;\n    spr.addComponent(Sprite);\n    spr.getComponent(UITransform).setAnchorPoint(new Vec2(0,1));\n    spr.getComponent(UITransform).width =width;\n    spr.getComponent(UITransform).height =height;\n    return spr;\n  }\n  \n  // 使用number类型代替NodeJS.Timeout\n  \n  // 截流函数示例\n  public static throttle<T extends (...args: any[]) => any>(\n    fn: T,\n    limit: number\n  ): T {\n    return function (...args: any[]) {\n      if (WebUtils.timeoutStream === null) {\n        WebUtils.timeoutStream = window.setTimeout(() => {\n          fn.apply(this, args);\n          WebUtils.timeoutStream = null; // 确保在函数执行后重置timeout\n        }, limit);\n      }\n    } as T;\n  }\n  \n  // 防抖函数示例\n  public static debounce<T extends (...args: any[]) => any>(\n    fn: T,\n    wait: number\n  ): T {\n    return function (...args: any[]) {\n      clearTimeout(WebUtils.timeoutStack as number);\n      WebUtils.timeoutStack = window.setTimeout(() => {\n        fn.apply(this, args);\n      }, wait);\n    } as T;\n  }\n}\n  \n  \n  "]}