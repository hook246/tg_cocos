{"version":3,"sources":["file:///Users/feiwang/NewProject_4/assets/resources/scripts/BoxCtl.ts"],"names":["_decorator","Component","Vec3","UITransform","tween","ccclass","property","BoxCtl","cur_box","start","update","deltaTime","random_box","parent","pos","index","Math","random","node","children","length","round","active","ele","setParent","setPosition","getChildByName","get_jump_position","world_pos","getWorldPosition","getParent","getComponent","convertToNodeSpaceAR","touch_start","delta_time","y","getScale","setScale","x","touch_end","scale_y","t1","to","scale","t2","t3","sequence","get_height","height","action_tween","getPosition","position"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3, UITransform, tween } from 'cc';\nconst { ccclass, property } = _decorator;\n\n/**\n * 箱子脚本\n * @author 一朵毛山\n * Construct \n */\n@ccclass('BoxCtl')\nexport class BoxCtl extends Component {\n    /**\n     * 本node显示的子节点\n     */\n    cur_box:Node = null;\n    start() {}\n\n    update(deltaTime: number) {    }\n\n    /**\n     * 随机生成箱子\n     * @param parent 箱子的父节点\n     * @param pos  箱子随机出来的位置\n     */\n    random_box(parent:Node,pos:Vec3){\n        let index= Math.random()*(this.node.children.length - 1); //27\n        index = Math.round(index);\n        this.cur_box = this.node.children[index];\n        this.cur_box.active = true;\n        for(let ele of this.node.children){\n            if(ele == this.cur_box){\n                continue;\n            }\n            ele.active = false;\n        }\n        this.node.setParent(parent);\n        this.node.setPosition(pos);\n\n        this.cur_box.getChildByName(\"jump_point\").active = false;\n\n    }\n\n    /**\n     * 获取跳跃的小白点在logic_layer的坐标,该坐标是通过转换获取的\n     * @returns \n     */\n    get_jump_position():Vec3{\n        let world_pos = this.cur_box.getChildByName(\"jump_point\").getWorldPosition();\n         return this.node.getParent().getComponent(UITransform).convertToNodeSpaceAR(world_pos);\n    }\n    \n    /**\n     * 触控屏幕时候调用,手指不松开开一直调用\n     * @param delta_time 帧时间\n     */\n    touch_start(delta_time:number){\n        let y = this.node.getScale().y - delta_time/6;\n        this.node.setScale(new Vec3(this.node.getScale().x,y));\n        if(this.node.getScale().y<=0.8){\n            this.node.setScale(new Vec3(this.node.getScale().x,0.8));\n        }\n    }\n\n    /**\n     * 触控结束后调用,手指松开立即调用,为了恢复箱子,并让箱子实现弹起效果\n     */\n    touch_end(){\n        let scale_y = 1 - this.node.getScale().y;\n        let t1 = tween(this.node).to(scale_y/5,{scale:new Vec3(this.node.getScale().x,1+scale_y/2)});\n        let t2 = tween(this.node).to(scale_y/8,{scale:new Vec3(this.node.getScale().x,1-scale_y/5)});\n        let t3 = tween(this.node).to(scale_y/5,{scale:new Vec3(this.node.getScale().x,1)});\n        tween(this.node).sequence(t1,t2,t3).start();\n    }\n\n    /**\n     * 获取箱子的高度\n     * @returns \n     */\n    get_height():number{\n        return this.cur_box.getChildByName(\"box\").getComponent(UITransform).height;\n    }\n\n\n    /**\n     * 箱子初始化到场景的动画,一个简单的弹跳动画\n     */\n    action_tween(){\n        let pos = this.node.getPosition();\n        this.node.setPosition(pos.x,pos.y+100);\n        tween(this.node)\n        .to(0.2,{position:new Vec3(this.node.getPosition().x,pos.y-10)})\n        .to(0.08,{position:new Vec3(this.node.getPosition().x,pos.y+50)})\n        .to(0.07,{position:new Vec3(this.node.getPosition().x,pos.y-5)})\n        .to(0.06,{position:new Vec3(this.node.getPosition().x,pos.y+10)})\n        .to(0.02,{position:new Vec3(this.node.getPosition().x,pos.y)})\n        .start();\n    }    \n    \n}\n\n"]}