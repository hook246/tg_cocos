{"version":3,"sources":["file:///Users/feiwang/tg_cocos/NewProject_4/assets/resources/scripts/draw/drawModel.ts"],"names":["_decorator","basePageModel","drawView","GlobalData","PromiseUtils","ccclass","property","local","local_token","drawLuckUrls","claim","isProduction","config","info","join","tickets_usdt","walletUrls","bindWallet","unbindWallet","queryBindWallet","drawModel","drawPage","account","tonConnectUI","timer_add","start","window","bindUxuyWallet","view","getComponent","console","log","manifest","TON_CONNECT_UI","TonConnectUI","manifestUrl","uiPreferences","searchConfig","getDrawLuckInfo","joinDrawLucy","getUserTicketsUsdtInfo","setTimerCount","index","Math","round","drawLuckyInfo","drawTime","wait","current_time","formatTimestamp","timer","string","setDrawLuckInfo","data","showDrawLuckRewardInfo","Number","tickets","cost_tickets","setJoinBtnUseAble","setJoinTips","update","deltaTime","bindTonWallet","connected","disconnect","onStatusChange","walletAndwalletInfo","wallet_address","controlConnectWalletBtnsVisible","home","getChildByName","active","walletInfo","axios","post","walletAddress","address","walletChain","chain","headers","token","setWalletInfo","openModal","timestamp","result","days","floor","hours","minutes","seconds","length","trim","initData","getWalletInfo","ticketCost","ticketsInfo","tiket","setCurrentTicketsUsdtCount","drawLuckyData","uxuyethereum","_account","chainName","uxuyWalletConnect","error","unBindWallet","controlUnbindBtnVisible","controlBindBtnVisible","code","copyAddress","navigator","clipboard","writeText","then","Telegram","WebApp","showPopup","title","message","buttons","id","text","type","buttonId","catch","err","get","setTicketsCost","drawInfo","join_count","count","showAlert","claimReward","drawId","reward","openDrawId","closeDrawLuckRewardInfo","win"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from \"cc\";\nimport { basePageModel } from \"../common/basePageModel\";\nimport { AxiosResponse } from \"../login/loginModel\";\nimport { GlobalConfig } from \"../home/GlobalConfig\";\nimport { drawView, QueryDrawRespDTO, QueryDrawRespDTOData } from \"./drawView\";\nimport GlobalData from '../home/GloabalClass'\nimport { PromiseUtils } from \"../common/PromiseUtils\";\nconst { ccclass, property } = _decorator;\n\nconst local = false\nconst local_token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dpblR5cGUiOiJQQVJUSUNMRSIsInVzZXJJZCI6IjE4MjgwMjA3NzY3NzU4NDc5MzYiLCJpYXQiOjE3Mjg5ODgxNDV9.qhV94PwKEKOJI1CtuLpLCqtJq78MOB-6AuHexqRvYTg'\n\nexport interface ticketsUsdt {\n  data:{\n    \"tiket\": number,\n    \"usdt\": number\n  }\n}\n\ndeclare global {\n  interface Window {\n    axios: {\n      post<T = any, R = AxiosResponse<T>, D = any>(\n        url: string,\n        data?: D,\n        config?: any\n      ): Promise<R>;\n      get<T = any, R = AxiosResponse<T>, D = any>(url: string, config?: any): Promise<R>;\n    };\n    startCanvas: any;\n    uxuyethereum: any;\n    uxuyWalletConnect: any;\n\n    bindUxuyWallet\n    TON_CONNECT_UI\n\n  }\n}\n\n// export const drawLuckUrls = {\n//   claim: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/claim\" : \"http://192.168.184.19:9002/hall/api/draw/claim\",\n//   config: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/config\":\n//     \"http://192.168.184.19:9002/hall/api/draw/config\",\n//   info: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/info\":\n//     \"http://192.168.184.19:9002/hall/api/draw/info\",\n//   join:GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/join\":\n//   \"http://192.168.184.19:9002/hall/api/draw/join\",\n//   tickets_usdt: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/user/info\":\n//   \"http://192.168.184.19:9002/hall/api/user/info\",\n// }\n\nexport const drawLuckUrls = {\n  claim: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/claim\" : \"https://api.infinitytest.cc/hall/api/draw/claim\",\n  config: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/config\":\n    \"https://api.infinitytest.cc/hall/api/draw/config\",\n  info: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/info\":\n    \"https://api.infinitytest.cc/hall/api/draw/info\",\n  join:GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/draw/join\":\n  \"https://api.infinitytest.cc/hall/api/draw/join\",\n  tickets_usdt: GlobalData.isProduction ? \"https://api.infinityg.ai/hall/api/user/info\":\n  \"https://api.infinitytest.cc/hall/api/user/info\",\n}\n\nexport const walletUrls = {\n  bindWallet: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/user/info/edit/bindWallet\" : \"https://api.infinitytest.cc/api/v1/user/info/edit/bindWallet\",\n  unbindWallet: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/user/info/edit/unbindWallet\":\n    \"https://api.infinitytest.cc/api/v1/user/info/edit/unbindWallet\",\n  queryBindWallet: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/user/info/queryBindWallet\":\n    \"https://api.infinitytest.cc/api/v1/user/info/queryBindWallet\",\n};\n\nexport interface BindWalletData {\n  walletAddress: string;\n  walletChain: string;\n}\n\nexport interface BindWalletResponse {\n  code: string;\n  message: string;\n}\n\nexport interface UnbindWalletData {}\n\nexport interface UnbindWalletResponse {\n  code: string;\n  message: string;\n}\n\nexport interface QueryBindWalletData {}\n\nexport interface QueryBindWalletResponse {\n  code: string;\n  data: {\n    walletAddress: string;\n    walletChain: string;\n  };\n  message: string;\n}\n\n@ccclass(\"drawModel\")\nexport class drawModel extends basePageModel {\n  drawPage: drawView\n\n  account;\n  tonConnectUI;\n\n  timer_add = 0\n\n  async start() {\n    window.bindUxuyWallet = this.bindUxuyWallet\n    this.drawPage = this.view.getComponent(drawView)\n\n    console.log(\"INIT the tonconnect \", this.tonConnectUI);\n    //提供一个manifest的json文件记录一些标题图标等数据用于UI连接时的展示\n    const manifest = \"https://catoss.s3.ap-southeast-1.amazonaws.com/telegram/manifest.json\";\n    console.log(manifest);\n    //获得TON_CONNECT_UI的实例\n    this.tonConnectUI = new window.TON_CONNECT_UI.TonConnectUI({\n      manifestUrl: manifest,\n      uiPreferences: {\n        //这里可以配置主题\n        // theme: TON_CONNECT_UI.THEME.DARK,\n      },\n    });\n\n    window['searchConfig'] = this.searchConfig\n    window['getDrawLuckInfo'] = this.getDrawLuckInfo\n    window['joinDrawLucy'] = this.joinDrawLucy\n    window['usdtInfo'] = this.getUserTicketsUsdtInfo\n    //this.claimReward\n    // if(this.tonConnectUI.connected) {\n    //     //断开连接重新加载\n    //     console.log(\"Disconnect for connection reload\")\n    //     await this.tonConnectUI.disconnect();\n    // }\n  }\n  \n  async setTimerCount(){\n    for(let index = Math.round(this.drawPage.drawLuckyInfo.drawTime / 1000); index >= 0; index--){\n      await PromiseUtils.wait(1000)\n      const current_time = this.formatTimestamp(index)\n      this.drawPage.timer.string = current_time\n      if(index <= 0){\n        const drawLuckyInfo = await this.getDrawLuckInfo()\n        this.drawPage.setDrawLuckInfo(drawLuckyInfo.data.data)\n        this.drawPage.showDrawLuckRewardInfo(drawLuckyInfo.data.data)\n        this.drawPage.setDrawLuckInfo(drawLuckyInfo.data.data)\n        if(Number(this.drawPage.tickets.string) < this.drawPage.cost_tickets){\n          this.drawPage.setJoinBtnUseAble(false)\n          this.drawPage.setJoinTips(Number(this.drawPage.tickets.string) - this.drawPage.cost_tickets)\n        }else{\n          this.drawPage.setJoinBtnUseAble(true)\n        }\n        await this.setTimerCount()\n      }else if(index <= 5 && index > 0){\n        this.drawPage.setJoinBtnUseAble(false)\n      }\n    }\n  }\n\n  async update(deltaTime: number) {\n\n  }\n\n  async bindTonWallet() {\n    if(this.tonConnectUI.connected){\n      await this.tonConnectUI.disconnect();\n    }\n    this.tonConnectUI.onStatusChange(async (walletAndwalletInfo) => {\n      //连接状态改变监听事件\n      if(GlobalData.wallet_address){\n        return\n      }\n      console.log(\"change : \", walletAndwalletInfo);\n      this.account = walletAndwalletInfo;\n      this.drawPage.controlConnectWalletBtnsVisible(false)\n      this.drawPage.home.getChildByName('tap_btns').active = true\n      const walletInfo = await window.axios.post<BindWalletResponse>(\n        walletUrls.bindWallet,{\n          walletAddress: walletAndwalletInfo.account.address,\n          walletChain: walletAndwalletInfo.account.chain,\n        },{\n          headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n            }\n        }\n      );\n      this.drawPage.setWalletInfo(walletAndwalletInfo.account.address)\n    });\n    await this.tonConnectUI.openModal();\n  }\n\n    //设置当前的倒计时\n    formatTimestamp(timestamp: number): string {\n      let result = '';\n      const days = Math.floor(timestamp / (3600 * 24));\n      const hours = Math.floor((timestamp % (3600 * 24)) / 3600);\n      const minutes = Math.floor((timestamp % 3600) / 60);\n      const seconds = timestamp % 60;\n    \n      if (days > 0) {\n        result += `${days} 天 `;\n      }\n      if (hours > 0 || result.length > 0) { // 如果已经有天数，即使小时数为0也显示\n        result += `${hours} 小时 `;\n      }\n      if (minutes > 0 || result.length > 0) { // 如果已经有天数或小时数，即使分钟数为0也显示\n        result += `${minutes} 分钟 `;\n      }\n      if (seconds > 0 || result.length > 0) { // 如果已经有天数、小时数或分钟数，即使秒数为0也显示\n        result += `${seconds} 秒`;\n      }\n    \n      return result.trim(); // 移除字符串两端的空格\n    }\n\n  async initData(){\n    const walletInfo = await this.getWalletInfo()\n    if(walletInfo?.walletAddress){\n      this.drawPage.setWalletInfo(walletInfo?.walletAddress)\n    }\n    const config = await this.searchConfig()\n    this.drawPage.cost_tickets = config.data.data.ticketCost\n    const ticketsInfo = await this.getUserTicketsUsdtInfo()\n    this.drawPage.setJoinTips(ticketsInfo.data.data.tiket - config.data.data.ticketCost)\n    this.drawPage.setCurrentTicketsUsdtCount(ticketsInfo.data)\n    const drawLuckyData = await this.getDrawLuckInfo()\n    if(drawLuckyData.data.data.join){\n      this.drawPage.setJoinBtnUseAble(false)\n    }else{\n      this.drawPage.setJoinBtnUseAble(true)\n    }\n    this.drawPage.setDrawLuckInfo(drawLuckyData.data.data)\n    this.setTimerCount()\n  }\n\n  async bindUxuyWallet() {\n    try {\n      this.drawPage.controlConnectWalletBtnsVisible(false)\n      this.drawPage.home.getChildByName('tap_btns').active = true\n      let walletAddress\n      let walletChain\n      if(window.uxuyethereum._account.address){\n        walletAddress = window.uxuyethereum._account.address\n        walletChain = window.uxuyethereum._account.chainName\n      }else{\n        await window.uxuyWalletConnect()\n        walletAddress = window.uxuyethereum._account.address\n        walletChain = window.uxuyethereum._account.chainName\n      }\n      console.log('========',walletAddress, walletChain)\n      const walletInfo = await window.axios.post<BindWalletResponse>(\n        walletUrls.bindWallet,{\n          walletAddress: walletAddress,\n          walletChain: walletChain,\n        },{\n          headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n            }\n        }\n      );\n      this.drawPage.setWalletInfo(walletAddress)\n\n    } catch (error) {\n      \n    }\n  }\n\n  async unBindWallet() {\n    const walletInfo = await window.axios.post<UnbindWalletResponse>(\n      walletUrls.unbindWallet\n    ,{},{\n        headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n          }\n    });\n    this.drawPage.controlUnbindBtnVisible(false)\n    this.drawPage.controlBindBtnVisible(true)\n    GlobalData.wallet_address = null\n    return walletInfo?.data?.code;\n  }\n\n  async getWalletInfo() {\n    const walletInfo = await window.axios.post<QueryBindWalletResponse>(\n      walletUrls.queryBindWallet\n    ,{},{\n        headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n          }\n    });\n    return walletInfo?.data?.data;\n  }\n\n  async copyAddress(){\n    navigator.clipboard.writeText(this.drawPage.address.string).then(function() {\n      window.Telegram.WebApp.showPopup({\n        title: 'Copy Success', // 弹出窗口的标题\n        message: 'copy address success！', // 弹出窗口的消息内容\n        buttons: [\n          { id: 'btn2', text: 'Button 2', type: 'ok' }, // 'type' 可以是 'ok', 'close', 'cancel', 'default', 'destructive'\n          { id: 'btn3', text: 'Button 3', type: 'cancel' }\n        ]\n      }, (buttonId) => {\n        // 弹出窗口关闭时的回调函数\n        if (buttonId) {\n          console.log('User pressed button:', buttonId);\n        } else {\n          console.log('Popup was closed without pressing a button');\n        }\n      });\n    }).catch(err => {\n      window.Telegram.WebApp.showPopup({\n        title: 'Copy failed', // 弹出窗口的标题\n        message: 'copy address failed', // 弹出窗口的消息内容\n        buttons: [\n          { id: 'btn2', text: 'Button 2', type: 'ok' }, // 'type' 可以是 'ok', 'close', 'cancel', 'default', 'destructive'\n          { id: 'btn3', text: 'Button 3', type: 'cancel' }\n        ]\n      }, (buttonId) => {\n        // 弹出窗口关闭时的回调函数\n        if (buttonId) {\n          console.log('User pressed button:', buttonId);\n        } else {\n          console.log('Popup was closed without pressing a button');\n        }\n      });\n    });\n  }\n\n  async searchConfig(){\n    const config = await window.axios.get(drawLuckUrls.config, {\n      headers: { \n          'Authorization': `Bearer ${local ? local_token : GlobalData.token}`\n        }\n    })\n    this.drawPage.setTicketsCost(config.data.data.ticketCost)\n    return config\n  }\n\n  async getDrawLuckInfo(){\n    const drawInfo = await window.axios.get<QueryDrawRespDTOData>(drawLuckUrls.info, {\n      headers: { \n          'Authorization': `Bearer ${local ? local_token : GlobalData.token}`\n        }\n    })\n    console.log('=====', drawInfo)\n    return drawInfo\n  } \n\n  async joinDrawLucy(){\n    try {\n      this.drawPage.setJoinBtnUseAble(false)\n      const join = await window.axios.get(drawLuckUrls.join, {\n        headers: { \n            'Authorization': `Bearer ${local ? local_token : GlobalData.token}`\n          }\n      })\n      this.drawPage.join_count.string = join.data.data.count\n      this.drawPage.tickets.string = join.data.data.tiket\n      this.drawPage.setJoinBtnUseAble(false)\n      window.Telegram.WebApp.showAlert(\"join success!\", () => {\n        console.log(\"\");\n      });\n    } catch (error) {\n      this.drawPage.setJoinBtnUseAble(false)\n      window.Telegram.WebApp.showAlert(\"join failed!\", () => {\n        console.log(\"\");\n      });\n    }\n\n  }\n\n  async claimReward(drawId: string){\n    try {\n      const reward = await window.axios.post<ticketsUsdt>(drawLuckUrls.claim,{\n        \"drawId\": `${this.drawPage.drawLuckyInfo.openDrawId}`\n     }, {\n       headers: {\n           'Authorization': `Bearer ${local ? local_token : GlobalData.token}`\n         }\n     })\n     this.drawPage.setCurrentTicketsUsdtCount(reward.data)\n     this.drawPage.closeDrawLuckRewardInfo()\n     this.drawPage.drawLuckyInfo.openDrawId = null\n     this.drawPage.drawLuckyInfo.win = false\n     window.Telegram.WebApp.showAlert(\"claim success!\", () => {\n       console.log(\"\");\n     });\n\n    } catch (error) {\n      window.Telegram.WebApp.showAlert(\"claim failed!\", () => {\n        console.log(\"\");\n      });\n    }\n\n  }\n\n  async getUserTicketsUsdtInfo(){\n    const info = await window.axios.get<ticketsUsdt>(drawLuckUrls.tickets_usdt, {\n      headers: {\n          'Authorization': `Bearer ${local ? local_token : GlobalData.token}`\n        }\n    })\n    return info\n  }\n}\n"]}