{"version":3,"sources":["file:///Users/feiwang/NewProject_4/assets/resources/scripts/draw/drawModel.ts"],"names":["_decorator","basePageModel","drawView","GlobalData","ccclass","property","walletUrls","bindWallet","unbindWallet","queryBindWallet","drawModel","drawPage","start","window","bindUxuyWallet","view","getComponent","walletInfo","getWalletInfo","update","deltaTime","controlConnectWalletBtnsVisible","walletAddress","walletChain","uxuyethereum","_account","address","chainName","uxuyWalletConnect","console","log","axios","post","headers","token","setWalletInfo","error","unBindWallet","controlUnbindBtnVisible","data","code"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from \"cc\";\nimport { basePageModel } from \"../common/basePageModel\";\nimport { AxiosResponse } from \"../login/loginModel\";\nimport { GlobalConfig } from \"../home/GlobalConfig\";\nimport { drawView } from \"./drawView\";\nimport GlobalData from '../home/GloabalClass'\nconst { ccclass, property } = _decorator;\n\ndeclare global {\n  interface Window {\n    axios: {\n      post<T = any, R = AxiosResponse<T>, D = any>(\n        url: string,\n        data?: D,\n        config?: any\n      ): Promise<R>;\n    };\n    startCanvas: any;\n    uxuyethereum: any;\n    uxuyWalletConnect: any;\n\n    bindUxuyWallet\n  }\n}\n\nexport const walletUrls = {\n  bindWallet: \"https://api.infinitytest.cc/api/v1/user/info/edit/bindWallet\",\n  unbindWallet:\n    \"https://api.infinitytest.cc/api/v1/user/info/edit/unbindWallet\",\n  queryBindWallet:\n    \"https://api.infinitytest.cc/api/v1/user/info/queryBindWallet\",\n};\n\nexport interface BindWalletData {\n  walletAddress: string;\n  walletChain: string;\n}\n\nexport interface BindWalletResponse {\n  code: string;\n  message: string;\n}\n\nexport interface UnbindWalletData {}\n\nexport interface UnbindWalletResponse {\n  code: string;\n  message: string;\n}\n\nexport interface QueryBindWalletData {}\n\nexport interface QueryBindWalletResponse {\n  code: string;\n  data: {\n    walletAddress: string;\n    walletChain: string;\n  };\n  message: string;\n}\n\n@ccclass(\"drawModel\")\nexport class drawModel extends basePageModel {\n  drawPage: drawView\n  async start() {\n    window.bindUxuyWallet = this.bindUxuyWallet\n    this.drawPage = this.view.getComponent(drawView)\n    const walletInfo = await this.getWalletInfo()\n  }\n\n  update(deltaTime: number) {}\n\n  async bindUxuyWallet() {\n    try {\n      this.drawPage.controlConnectWalletBtnsVisible(false)\n      let walletAddress\n      let walletChain\n      if(window.uxuyethereum._account.address){\n        walletAddress = window.uxuyethereum._account.address\n        walletChain = window.uxuyethereum._account.chainName\n      }else{\n        await window.uxuyWalletConnect()\n        walletAddress = window.uxuyethereum._account.address\n        walletChain = window.uxuyethereum._account.chainName\n      }\n      console.log('========',walletAddress, walletChain)\n      const walletInfo = await window.axios.post<BindWalletResponse>(\n        walletUrls.bindWallet,{\n          walletAddress: walletAddress,\n          walletChain: walletChain,\n        },{\n          headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n            }\n        }\n      );\n      this.drawPage.setWalletInfo(walletAddress)\n\n    } catch (error) {\n      \n    }\n  }\n\n  async unBindWallet() {\n    const walletInfo = await window.axios.post<UnbindWalletResponse>(\n      walletUrls.unbindWallet\n    ,{},{\n        headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n          }\n    });\n    this.drawPage.controlUnbindBtnVisible(false)\n    return walletInfo?.data?.code;\n  }\n\n  async getWalletInfo() {\n    const walletInfo = await window.axios.post<QueryBindWalletResponse>(\n      walletUrls.queryBindWallet\n    ,{},{\n        headers: { \n              'Authorization': `Bearer ${GlobalData.token}`\n          }\n    });\n    return walletInfo?.data?.data;\n  }\n}\n"]}