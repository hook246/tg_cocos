{"version":3,"sources":["file:///Users/feiwang/NewProject_4/assets/resources/scripts/profile/profileModel.ts"],"names":["_decorator","basePageModel","GlobalData","profileView","homeView","inviteModel","ccclass","property","profileModel","start","view","getComponent","update","deltaTime","unBindTwitter","unbindTwitterUrl","bindData","window","axios","post","headers","token","error","console","log","resetBindUi","bindTwitter","twitterOauthUrl","Telegram","WebApp","showPopup","title","message","buttons","id","text","type","buttonId","openLink","tryInstantView","scheduleOnce","showCheckInfoPopUp","home","invitePage","initData","setTwitterInfo"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node } from 'cc';\nimport { basePageModel } from '../common/basePageModel';\nimport GlobalData from '../home/GloabalClass';\nimport { profileView } from './profileView';\nimport { homeView } from '../home/homeView';\nimport { inviteView } from '../invite/inviteView';\nimport { inviteModel } from '../invite/inviteModel';\nconst { ccclass, property } = _decorator;\n\n@ccclass('profileModel')\nexport class profileModel extends basePageModel {\n    profileView: profileView\n\n\n    start() {\n        this.profileView = this.view.getComponent(profileView)\n    }\n\n    update(deltaTime: number) {\n        \n    }\n\n    async unBindTwitter(){\n        const unbindTwitterUrl = 'https://api.infinitytest.cc/api/v1/oauth/unboundTwitter'\n        try {\n            //登录成功\n            const bindData = await window.axios.post<any>(\n                unbindTwitterUrl,\n              {\n\n              },{\n                headers: { \n                      'Authorization': `Bearer ${GlobalData.token}`\n                }\n            })\n        } catch (error) {\n          console.log(error);\n        }\n        this.profileView.resetBindUi()\n    }\n\n    bindTwitter(){\n        const twitterOauthUrl = `https://www.infinitytest.cc?tgId=${GlobalData.token}`\n        //this.profileView.closeProfile()\n        window.Telegram.WebApp.showPopup({\n            title: '请选择一个选项',\n            message: '你想要做什么？',\n            buttons: [\n              { id: 'button1', text: 'bind now' },\n              { id: 'button2', text: 'bind later', type: 'cancel' }\n            ]\n          }, (buttonId) => {\n            // 弹出窗口关闭时的回调函数\n            if (buttonId) {\n              switch (buttonId) {\n                case 'button1':\n                  window.Telegram.WebApp.openLink(`${twitterOauthUrl}`, { tryInstantView: true });\n                  this.scheduleOnce(()=>{\n                    this.showCheckInfoPopUp()\n                  }, 2)\n\n                  break;\n                case 'button2':\n                  // 如果是取消按钮，通常不需要执行任何操作，因为它默认会关闭弹出窗口\n                  break;\n                default:\n                  console.log('未知的按钮被点击');\n              }\n            } else {\n              console.log('弹出窗口被关闭，没有点击任何按钮');\n            }\n          });\n    }\n\n    showCheckInfoPopUp(){\n        window.Telegram.WebApp.showPopup({\n            title: 'Success',\n            message: 'You have already bound your Twitter!',\n            buttons: [\n              { id: 'button1', text: 'ok' },\n            ]\n          }, async (buttonId) => {\n            // 弹出窗口关闭时的回调函数\n            if (buttonId) {\n              switch (buttonId) {\n                case 'button1':\n                  await this.profileView.home.getComponent(homeView).invitePage.getComponent(inviteModel).initData()\n                  this.profileView.setTwitterInfo()\n                  break;\n                default:\n                  console.log('未知的按钮被点击');\n              }\n            } else {\n              console.log('弹出窗口被关闭，没有点击任何按钮');\n            }\n          });\n    }\n\n    initData(){\n        this.profileView.setTwitterInfo()\n    }\n}\n\n"]}