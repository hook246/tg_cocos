{"version":3,"sources":["file:///Users/feiwang/tg_cocos/NewProject_4/assets/resources/scripts/login/loginModel.ts"],"names":["_decorator","Node","basePageModel","loginView","GlobalData","drawModel","discoverModel","homeView","inviteModel","earnModel","profileModel","ccclass","property","init_id","id","macSHA_secret","startWithSrc","pathMaps","walletType","walletChain","trackUrl","isProduction","loginUrls","firstLoginCheck","tgLogin","pwdLogin","twitterOauth","bindTwitter","unBindTwitter","loginModel","Boolean","start","view","getComponent","tgId","URLSearchParams","window","location","search","get","code","state","isUseMock","setPosition","isFirst","checkLoginFirst","controlLoading","controlLoginTypeBtnsVisible","update","deltaTime","trackPath","path","track","axios","post","Telegram","WebApp","initDataUnsafe","user","source","name","username","isFirstLogin","data","firstLogin","error","console","log","initData","bindData","headers","gameInitData","inviteCode","loginData","atob","startsWith","indexOf","JSON","parse","token","trackSrc","userName","avatar","home","setProfile","game_point","string","String","totalPoint","routeToHome","initOtherModel","scheduleOnce","node","discover","draw","invite","earn","profile","veteranLogin","checkVeteranInput","showVeteranError","accountUserName","getAccountInputString","loginChannel","password","getPasswordInputString"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from \"cc\";\nimport { basePageModel } from \"../common/basePageModel\";\nimport { loginView } from \"./loginView\";\nimport { GlobalConfig } from \"../home/GlobalConfig\";\nimport _ from \"lodash\";\nimport GlobalData from \"../home/GloabalClass\";\nimport { drawModel } from \"../draw/drawModel\";\nimport { discoverModel } from \"../discover/discoverModel\";\nimport { homeView } from \"../home/homeView\";\nimport { inviteModel, taskUrls } from \"../invite/inviteModel\";\nimport { earnView } from \"../earn/earnView\";\nimport { earnModel } from \"../earn/earnModel\";\nimport { profileModel } from \"../profile/profileModel\";\nconst { ccclass, property } = _decorator;\n\nconst init_id = \"query_id=AAGqe7QbAwAAAKp7tBsBtSzB&user=%7B%22id%22%3A6907263914%2C%22first_name%22%3A%22Infinity%20Ground%22%2C%22last_name%22%3A%22%22%2C%22username%22%3A%22InfinityGround_11%22%2C%22language_code%22%3A%22zh-hans%22%2C%22allows_write_to_pm%22%3Atrue%7D&auth_date=1728804036&hash=edb3dfb61fee2f83975d927d31b976e97d1c85d353d9b5da6f05640dfe27233e\";\nconst id = 6703818363\nconst macSHA_secret =\n  \"0d42f108fb7d74f3735c61b1ecdeb8662bef043f2afed10fb3cd3aba3007e0ff\";\n\nconst startWithSrc = 'tgSrc'\n\nconst pathMaps = [\n  'funking',\n  '',\n]\n\nexport interface AxiosResponse<T = any, D = any> {\n  data: T;\n  status: number;\n  statusText: string;\n  headers: any;\n  config: any;\n  request?: any;\n}\n\ndeclare global {\n  interface Window {\n    axios: {\n      post<T = any, R = AxiosResponse<T>, D = any>(\n        url: string,\n        data?: D,\n        config?: any\n      ): Promise<R>;\n    };\n    startCanvas: any;\n    Telegram: any;\n    CryptoJS: any;\n  }\n}\n\nexport enum walletType {}\n\nexport enum walletChain {}\n\nexport const trackUrl = GlobalData.isProduction ? 'https://api.infinityg.ai/hall/api/telegram/user/src/add' : 'https://api.infinitytest.cc/hall/api/telegram/user/src/add'\n\nexport const loginUrls = {\n  firstLoginCheck: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/user/auth/first_login\" : \"https://api.infinitytest.cc/api/v1/user/auth/first_login\",\n  tgLogin: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/user/auth/tg_login/webapp\" : \"https://api.infinitytest.cc/api/v1/user/auth/tg_login/webapp\",\n  pwdLogin: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/user/auth/pwd_login\" : \"https://api.infinitytest.cc/api/v1/user/auth/pwd_login\",\n};\n\nexport const twitterOauth = {\n  bindTwitter: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/oauth/getTwitterCode\" : \"https://api.infinitytest.cc/api/v1/oauth/getTwitterCode\",\n  unBindTwitter: GlobalData.isProduction ? \"https://api.infinityg.ai/api/v1/oauth/unboundTwitter\" : \"https://api.infinitytest.cc/api/v1/oauth/unboundTwitter\",\n};\n\nexport interface bindTwitterResponse {\n  code: string;\n  data: {\n    accessToken: string;\n    expiresIn: number;\n    refreshToken: string;\n    scope: string;\n    tokenType: string;\n  };\n  message: string;\n}\n\nexport interface firstLoginCheckDataType {\n  id: number;\n}\n\nexport interface firstLoginCheckResponseType {\n  code: string;\n  data: {\n    firstLogin: true;\n  };\n  message: string;\n}\n\nexport interface tgLoginDataType {\n  initData: string;\n  inviteCode: string;\n  loginChannel: string;\n}\n\nexport interface tgLoginResponseType {\n  code: string;\n  data: {\n    avatar: string;\n    email: string;\n    expiration: number;\n    gamePoint: number;\n    inviteCode: string;\n    isNewUser: true;\n    isSetPwd: true;\n    token: string;\n    totalPoint: 0;\n    userId: number;\n    userName: string;\n    walletAddress: string;\n    walletChain: \"ETH\";\n    walletType: \"METAMASK\";\n  };\n  message: string;\n}\n\nexport interface pwdLoginDataType {\n  accountUserName: string;\n  password: string;\n  initData?: string;\n  inviteCode?: string;\n  loginChannel?: \"GAME_LOBBY\";\n}\n\nexport interface pwdLoginResponseType {\n  code: string;\n  data: {\n    totalPoint: any;\n    avatar: string;\n    email: string;\n    expiration: number;\n    gamePoint: number;\n    inviteCode: string;\n    isNewUser: true;\n    isSetPwd: true;\n    token: string;\n    userId: number;\n    userName: string;\n    walletAddress: string;\n    walletChain: \"ETH\";\n    walletType: \"METAMASK\";\n  };\n  message: string;\n}\n\n@ccclass(\"loginModel\")\nexport class loginModel extends basePageModel {\n  @property(Boolean)\n  isUseMock: boolean = false;\n\n  @property(Node)\n  profile: Node = null;\n\n  @property(Node)\n  discover: Node = null;\n\n  @property(Node)\n  invite: Node = null;\n\n  @property(Node)\n  earn: Node = null;\n\n  @property(Node)\n  draw: Node = null;\n\n  @property(Node)\n  home: Node = null;\n\n  loginView: loginView;\n  async start() {\n    this.loginView = this.view.getComponent(loginView);\n    const tgId = new URLSearchParams(window.location.search).get(\"tgId\");\n    const code = new URLSearchParams(window.location.search).get(\"code\");\n    const state = new URLSearchParams(window.location.search).get(\"state\");\n\n    if (this.isUseMock) {\n    }\n    this.view.setPosition(0, 0);\n    const isFirst = await this.checkLoginFirst();\n    if (isFirst) {\n      //展示登录页面\n      this.loginView.controlLoading(false);\n      this.loginView.controlLoginTypeBtnsVisible(true);\n    } else {\n      await this.tgLogin();\n    }\n  }\n\n  update(deltaTime: number) {}\n\n  async trackPath(path: string){\n    const track = await window.axios.post<any>(\n      trackUrl,\n      {\n        tgId: window.Telegram.WebApp.initDataUnsafe.user.id,\n        source: path,\n        name: window.Telegram.WebApp.initDataUnsafe.user.username\n      }\n    );\n  }\n\n  async checkLoginFirst() {\n    try {\n      const isFirstLogin = await window.axios.post<firstLoginCheckResponseType>(\n        loginUrls.firstLoginCheck,\n        {\n          id: window?.Telegram?.WebApp?.initDataUnsafe?.user?.id ? window?.Telegram?.WebApp?.initDataUnsafe?.user?.id : id,\n        }\n      );\n      return isFirstLogin.data.data.firstLogin;\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  async bindTwitter(initData, code, state) {\n    try {\n        //登录成功\n        const bindData = await window.axios.post<bindTwitterResponse>(\n          twitterOauth.bindTwitter,\n          {\n            code: code,\n            state: state,\n          },{\n            headers: { \n                  'Authorization': `Bearer ${initData}`\n            }\n        })\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  async tgLogin() {\n    try {\n      const gameInitData = new URLSearchParams(window.location.search).get(\"gameData\");\n      const inviteCode = new URLSearchParams(window.location.search).get(\n        \"tgWebAppStartParam\"\n      );\n      console.log(\"initData\", window?.Telegram?.WebApp?.initData);\n      console.log('gameData',gameInitData)\n      const loginData = await window.axios.post<tgLoginResponseType>(\n        loginUrls.tgLogin,\n        {\n          initData: window?.Telegram?.WebApp?.initData\n            ? window?.Telegram?.WebApp?.initData : gameInitData ? window.atob(gameInitData)\n            : init_id,\n          // photoUrl: `${\n          //   window.Telegram.WebApp.initDataUnsafe.user.photo_url ? window.Telegram.WebApp.initDataUnsafe.user.photo_url : ''\n          // }`,\n          inviteCode: !inviteCode.startsWith(startWithSrc) && pathMaps.indexOf(inviteCode) < 0 && inviteCode\n            ? JSON.parse(window.atob(inviteCode))?.inviteCode\n            : \"\",\n        }\n      );\n      console.log(\"=========\", loginData);\n      if (loginData?.data?.data?.token) {\n        //登录成功\n        this.trackSrc()\n        GlobalData.token = loginData?.data?.data?.token;\n        GlobalData.inviteCode = loginData?.data?.data?.inviteCode;\n        GlobalData.username = loginData.data.data.userName\n        GlobalData.avatar = loginData.data.data.avatar\n        this.home.getComponent(homeView).setProfile(GlobalData.avatar)\n        this.home.getComponent(homeView).game_point.string = String(\n          loginData.data.data.totalPoint\n        );\n        this.loginView.controlLoading(true);\n        this.loginView.routeToHome();\n        await this.initOtherModel();\n        this.scheduleOnce(()=>{\n          this.node.setPosition(-5000 ,0)\n          this.discover.setPosition(0, 0)\n          this.loginView.controlLoading(false);\n          console.log('=====close loading')\n        }, 3)\n\n        const path = new URLSearchParams(window.location.search).get(\n          \"tgWebAppStartParam\"\n        );\n        if(pathMaps.indexOf(path) >= 0){\n          this.trackPath(path)\n        }\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  trackSrc(){\n    //object 转字符串\n    // {\n    //   \"src\": \"tiktok\",\n    //   \"id\": \"1334\",\n    //   \"count\": \"100\",\n    // }\n    // const src_str = JSON.stringify(\n    //   {\n    //     \"src\": \"tiktok\",\n    //     \"id\": \"1334\",\n    //     \"count\": \"100\",\n    //   }\n    // )\n    //然后window.btoa(src_str)\n    //拼在https://t.me/infinity_ground_bot/infinity_ground_app?startapp=src_str\n    // const srcData = new URLSearchParams(window.location.search).get(\n    //   \"tgWebAppStartParam\"\n    // );\n    // const srcObject = srcData && JSON.parse(window.atob(srcData))\n    //console.log('srcObject===>', srcObject)\n  }\n\n  async initOtherModel() {\n    await this.draw.getComponent(drawModel).initData();\n    await this.discover.getComponent(discoverModel).initData();\n    await this.invite.getComponent(inviteModel).initData();\n    this.earn.getComponent(earnModel).initData();\n    this.profile.getComponent(profileModel).initData();\n  }\n  async veteranLogin() {\n    if (this.loginView.checkVeteranInput()) {\n      this.loginView.showVeteranError(true);\n    }\n\n    try {\n      const inviteCode = new URLSearchParams(window.location.search).get(\n        \"tgWebAppStartParam\"\n      );\n      \n      const gameInitData = new URLSearchParams(window.location.search).get(\"gameData\");\n      console.log(\"initData\", window?.Telegram?.WebApp?.initData);\n      console.log('gameData',gameInitData)\n      const loginData = await window.axios.post<pwdLoginResponseType>(\n        loginUrls.pwdLogin,\n        {\n          accountUserName: this.loginView.getAccountInputString(),\n          initData: window?.Telegram?.WebApp?.initData\n            ? window?.Telegram?.WebApp?.initData : gameInitData ? window.atob(gameInitData)\n            : init_id,\n          loginChannel: \"GAME_LOBBY\",\n          password: this.loginView.getPasswordInputString(),\n          inviteCode: inviteCode\n            ? JSON.parse(window.atob(inviteCode)).inviteCode\n            : \"\",\n          // photoUrl: `${\n          //   window.Telegram.WebApp.initDataUnsafe.user.photo_url ? window.Telegram.WebApp.initDataUnsafe.user.photo_url : ''\n          // }`,\n          //username: \"\",\n        }\n      );\n\n      if (loginData?.data?.data?.token) {\n        this.trackSrc()\n        GlobalData.token = loginData?.data?.data?.token;\n        GlobalData.inviteCode = loginData?.data?.data?.inviteCode;\n        GlobalData.username = loginData.data.data.userName\n        GlobalData.avatar = loginData.data.data.avatar\n        this.home.getComponent(homeView).setProfile(GlobalData.avatar)\n        this.home.getComponent(homeView).game_point.string = String(\n          loginData.data?.data?.totalPoint\n        );\n        this.loginView.controlLoading(true);\n        this.loginView.routeToHome();\n        await this.initOtherModel();\n        this.scheduleOnce(()=>{\n          this.node.setPosition(-5000 ,0)\n          this.discover.setPosition(0, 0)\n          this.loginView.controlLoading(false);\n          console.log('=====close loading')\n        }, 3)\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  \n}\n"]}