{"version":3,"sources":["file:///Users/feiwang/tg_cocos/NewProject_4/assets/resources/scripts/discover/discoverView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","basePageView","UIScrollSelectHorizontal","ccclass","property","discoverView_arrow","discoverView","shift_btns","currentGameScrollOffset","current_game_info","current_ugc_info","start","btn_shift_game","btn_shift_ugc","arrowTips","setPosition","localStorage","getItem","active","update","deltaTime","shiftCurrentPlayType","btn","data","forEach","node","getChildByName","currentTarget","game_part","ugc_part","initGameViews","gameList","initScrollPrefabs","initUgcViews","ugcList","list","father_node","hp","scroll_node","getComponent","scrollChildrenCount","length","scrollChildrenInfo","discover_view","addChild","type","setCurrentPlayInfo","play","index","info","game_description","string","desc","game_tittle","name","ugc_description","ugc_tittle","openCurrentPlayUrl","event","window","Telegram","WebApp","openTelegramLink","url","initDataUnsafe","user","id","tryInstantView","btoa","initData","console","log","markArrowTips","setItem","currentPageClose"],"mappings":"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","sourcesContent":["import {\n  _decorator,\n  Component,\n  EventTouch,\n  instantiate,\n  Label,\n  Node,\n  Prefab,\n  ScrollView,\n  Sprite,\n  UITransform,\n  Vec2,\n} from \"cc\";\nimport { basePageView } from \"../common/basePageView\";\nimport WebUtils from \"../common/WebUtils\";\nimport { UIScrollSelectHorizontal } from \"./UIScrollSelectHorizontal\";\nconst { ccclass, property } = _decorator;\n\nconst discoverView_arrow = 'discoverView_arrow'\n\n@ccclass(\"discoverView\")\nexport class discoverView extends basePageView {\n  @property(Node)\n  btn_shift_game: Node = null;\n\n  @property(Node)\n  btn_shift_ugc: Node = null;\n\n  @property(Node)\n  game_part: Node = null;\n\n  @property(Node)\n  ugc_part: Node = null;\n\n  @property(Prefab)\n  scroll_node: Prefab = null;\n\n  @property(Label)\n  game_description: Label = null;\n\n  @property(Label)\n  game_tittle: Label = null;\n\n  @property(Label)\n  ugc_description: Label = null;\n\n  @property(Label)\n  ugc_tittle: Label = null;\n\n  shift_btns: Node[] = [];\n\n  currentGameScrollOffset: any\n\n  current_game_info: {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }\n\n  current_ugc_info: {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }\n\n  start() {\n    this, (this.shift_btns = [this.btn_shift_game, this.btn_shift_ugc]);\n    this.arrowTips.setPosition(0, -423.163)\n    if(localStorage.getItem(discoverView_arrow)){\n      this.arrowTips.active = false\n    }\n\n    // this.node.getComponent(ScrollView).scrollToBottom()\n    // this.node.getComponent(ScrollView).scrollToTop()\n    // this.game_father_node.on(Node.EventType.TOUCH_START, (event) => {\n    //     this.currentGameScrollOffset = this.game_father_node.getComponent(ScrollView).getScrollOffset()\n    // });\n\n    // this.game_father_node.on(Node.EventType.TOUCH_END, (event: EventTouch) => {\n\n    //   const startPos = event.touch.getStartLocation();\n    //   const prePos = event.touch.getPreviousLocation();\n\n\n    //   let offset;\n    //   if (startPos.x > prePos.x) {\n    //     offset = -500;\n    //   } else {\n    //     offset = 500;\n    //   }\n      \n    //   const scroll = this.game_father_node.getComponent(ScrollView);\n    //   console.log('========',scroll.getScrollOffset().x,this.currentGameScrollOffset.x )\n    //   scroll.scrollToOffset(\n    //     new Vec2(\n    //       this.currentGameScrollOffset.x + 100,\n    //       0\n    //     ),\n    //     1,\n    //     true\n    //   );\n    //   this.currentGameScrollOffset.x = this.currentGameScrollOffset.x +100 \n\n    // });\n    \n  }\n\n  update(deltaTime: number) {}\n\n  shiftCurrentPlayType(btn: EventTouch, data: string) {\n    this.shift_btns.forEach((node) => {\n      node.getChildByName(\"selected\").active = false;\n      node.getChildByName(\"selected_lable\").active = false;\n      node.getChildByName(\"unselected_lable\").active = true;\n    });\n    btn.currentTarget.getChildByName(\"selected\").active = true;\n    btn.currentTarget.getChildByName(\"selected_lable\").active = true;\n    btn.currentTarget.getChildByName(\"unselected_lable\").active = false;\n    if (data === \"game\") {\n      this.game_part.active = true;\n      this.ugc_part.active = false;\n    } else {\n      this.game_part.active = false;\n      this.ugc_part.active = true;\n    }\n  }\n\n  initGameViews(\n    gameList: {\n      desc: string;\n      hot: number;\n      id: number;\n      icon: string;\n      name: string;\n      position: number;\n      sort: number;\n      tags: string[];\n      type: number;\n      url: string;\n    }[]\n  ) {\n    this.initScrollPrefabs(gameList, this.game_part)\n  }\n\n  initUgcViews(\n    ugcList: {\n      desc: string;\n      hot: number;\n      id: number;\n      icon: string;\n      name: string;\n      position: number;\n      sort: number;\n      tags: string[];\n      type: number;\n      url: string;\n    }[]\n  ) {\n    this.initScrollPrefabs(ugcList, this.ugc_part)\n  }\n\n  initScrollPrefabs(list:  {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }[], father_node: Node){\n    let hp = instantiate(this.scroll_node);\n    hp.getComponent(UIScrollSelectHorizontal).scrollChildrenCount = list.length\n    hp.getComponent(UIScrollSelectHorizontal).scrollChildrenInfo = list\n    hp.getComponent(UIScrollSelectHorizontal).discover_view = this.node.getComponent(discoverView)\n    father_node.addChild(hp);\n    hp.setPosition(0, 0);\n    list[0].type === 1 ? this.setCurrentPlayInfo(list[1]) : this.setCurrentPlayInfo(list[0])\n    list.forEach((play, index) => {\n\n    });\n  }\n\n  setCurrentPlayInfo(info:  {\n    desc: string;\n    hot: number;\n    id: number;\n    icon: string;\n    name: string;\n    position: number;\n    sort: number;\n    tags: string[];\n    type: number;\n    url: string;\n  }){\n    if(info.type === 1){\n        this.game_description.string = info.desc\n        this.game_tittle.string = info.name\n        this.current_game_info = info\n    }else{\n        this.ugc_description.string = info.desc\n        this.ugc_tittle.string = info.name\n        this.current_ugc_info = info\n    }\n  }\n\n  openCurrentPlayUrl(event, data:string){\n    if(data === '1'){\n        window.Telegram.WebApp.openTelegramLink(`${this.current_game_info.url}?startapp=TG${window?.Telegram?.WebApp?.initDataUnsafe?.user?.id}`, { tryInstantView: true });\n    }else{\n        window.Telegram.WebApp.openTelegramLink(`${this.current_ugc_info.url}?startapp=${window.btoa(window?.Telegram?.WebApp?.initData)}`, { tryInstantView: true });\n        console.log('====Telegram', `${this.current_ugc_info.url}?startapp=${window.btoa(window?.Telegram?.WebApp?.initData)}`)\n    }\n  }\n\n  markArrowTips(){\n    this.arrowTips.active = false\n    localStorage.setItem(discoverView_arrow, 'arrowTips')\n  }\n\n  currentPageClose() {}\n}"]}