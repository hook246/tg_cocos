{"version":3,"sources":["file:///Users/feiwang/NewProject_4/assets/resources/scripts/HeroCtl.ts"],"names":["_decorator","Component","Node","Vec3","tween","Label","Sprite","Color","Prefab","instantiate","UITransform","BoxCtl","HeroColliderCtl","ccclass","property","HeroCtl","type","start","hero_score","active","light","update","deltaTime","init_hero","parent","pos","node","setParent","setPosition","x","y","to","position","getPosition","touch_start","delta_time","box_height","getScale","setScale","jump_start_effect","touch_end","getChildByName","removeAllChildren","jump_by_box","target_box","touch_time","callback","hero_collier_ctl","reset_data","jump_postion","get_jump_position","hero_postion","nor_v3","subtract","normalize","target_postion","jump_by_postion","angle_x","jumpping","jump_to","jump_start","call","close_collider","angle","jump_end","open_collider","scheduleOnce","get_step_score","get_collider_node","sequence","set_sibling","index","setSiblingIndex","reset_angle","show_score","score","getComponent","string","scale","sprite","color","r","g","b","base_color","clone","temp_color","onUpdate","target","ratio","alpha","a","set","slip","by","Math","random","miss","original","target_pos","getSiblingIndex","children","length","ball","pre_ball","floor","r_x","r_y","setContentSize","removeSelf","jump_end_effect","i"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Vec3, tween, Label, Sprite, Color, Prefab, instantiate, UITransform } from 'cc';\nimport { BoxCtl } from './BoxCtl';\nimport { HeroColliderCtl } from './HeroColliderCtl';\nconst { ccclass, property } = _decorator;\n\n/**\n * 英雄脚本\n * @author 一朵毛山\n * Construct \n */\n@ccclass('HeroCtl')\nexport class HeroCtl extends Component {\n\n    /**\n     * 英雄碰撞体,脚本\n     */\n    @property({type:HeroColliderCtl})\n    hero_collier_ctl: HeroColliderCtl;\n\n    /**\n     * 英雄身上的得分node\n     */\n    @property({type:Node})\n    hero_score: Node;\n    /**\n     * 英雄身上的光圈\n     */\n    @property({type:Node})\n    light: Node;\n    /**\n     * 小白球预制体,用于显示跳跃/落地特效的\n     */\n    @property({type:Prefab})\n    pre_ball: Prefab;\n\n    start() {\n        //开局,得分/得分光圈都不显示\n        this.hero_score.active = false;\n        this.light.active =false;\n    }\n\n    update(deltaTime: number) {\n        \n    }\n\n    /**\n     * 英雄的初始化\n     * @param parent 英雄的父节点\n     * @param pos 初始化的位置,在logic_layer\n     */\n    init_hero(parent:Node,pos:Vec3){\n        this.node.setParent(parent);\n        this.node.setPosition(pos.x,pos.y+200);\n        //弹跳动画\n        tween(this.node)\n            .to(0.2,{position:new Vec3(this.node.getPosition().x,pos.y-10)})\n            .to(0.08,{position:new Vec3(this.node.getPosition().x,pos.y+50)})\n            .to(0.07,{position:new Vec3(this.node.getPosition().x,pos.y-5)})\n            .to(0.06,{position:new Vec3(this.node.getPosition().x,pos.y+10)})\n            .to(0.02,{position:new Vec3(this.node.getPosition().x,pos.y)})\n            .start();\n    }\n\n    /**\n     * 触控过程中调用,实现英雄变成矮胖子效果\n     * @param delta_time 帧时间\n     * @param box_height 脚下箱子的高度\n     */\n    touch_start(delta_time: number,box_height: number){\n         let y = this.node.getScale().y - delta_time/6;\n         //英雄的压缩效果\n         this.node.setScale(new Vec3(this.node.getScale().x,y));\n         if(this.node.getScale().y<=0.8){\n            this.node.setScale(new Vec3(this.node.getScale().x,0.8));\n         }   \n         let x = this.node.getScale().x+delta_time/10;\n         this.node.setScale(new Vec3(x,this.node.getScale().y));\n         if(this.node.getScale().x>=1.2){\n            this.node.setScale(new Vec3(1.2,this.node.getScale().y));\n         }\n         //限制最大压缩比例\n         if(this.node.getScale().y>0.8){\n            let pos = this.node.getPosition();\n            this.node.setPosition(new Vec3(pos.x,pos.y-delta_time/8*box_height));\n         }\n\n         this.jump_start_effect();\n\n    }\n\n    /**\n     * 触控结束调用,用于恢复英雄的身高\n     */\n    touch_end(){\n        this.node.setScale(new Vec3(1,1));\n        this.node.getChildByName(\"ball_group\").removeAllChildren();\n    }\n\n    /**\n     * 根据箱子实现跳跃\n     * @param target_box 目标箱子脚本\n     * @param touch_time 触控的时间\n     * @param callback 回调函数\n     */\n    jump_by_box(target_box:BoxCtl,touch_time:number,callback:Function){\n        this.hero_collier_ctl.reset_data();\n        //获取小白点postion\n        let jump_postion = target_box.get_jump_position();\n        //hero postion\n        let hero_postion = this.node.getPosition();\n        //归一化\n        let nor_v3 = jump_postion.subtract(hero_postion).normalize();\n        touch_time *=8;\n        //落点\n        let target_postion = new Vec3(hero_postion.x+nor_v3.x*touch_time,hero_postion.y+nor_v3.y*touch_time);\n        this.jump_by_postion(target_postion,nor_v3.x,callback);\n    }\n\n    /**\n     * 根据坐标实现跳跃\n     * @param target_postion 目标坐标\n     * @param angle_x 用于判断旋转反向\n     * @param callback 回调函数\n     */\n    jump_by_postion(target_postion:Vec3,angle_x:number,callback:Function){\n        //执行跳跃\n        let jumpping = this.node.jump_to(target_postion,200,0.4);\n        // 旋转\n        let jump_start = tween(this.node).call(()=>{\n            //跳跃前关闭碰撞\n            this.close_collider();\n            tween(this.node.getChildByName(\"body\")).to(0.4,{angle:angle_x<0?360:-360}).start();\n        });\n\n        let jump_end = tween(this.node).call(()=>{\n            //到达跳跃点后,打开碰撞\n            this.open_collider();\n            //延迟执行,用于碰撞逻辑计算,碰撞逻辑需要点时间\n            this.scheduleOnce(()=>{\n                this.close_collider();\n                callback?.(this.hero_collier_ctl.get_step_score(),this.hero_collier_ctl.get_collider_node());\n            },0.1);\n        });\n        //按照序列动画,顺序执行\n        tween(this.node).sequence(jump_start,jumpping,jump_end).start();\n    }\n\n    /**\n     * 设置英雄的sibling,控制英雄在logic_layer的显示层\n     * @param index \n     */\n    set_sibling(index:number){\n        this.node.setSiblingIndex(index);\n    }\n\n    /**\n     * 重置欧拉角,每次跳跃时候需要调用\n     */\n    reset_angle(){\n        this.node.getChildByName(\"body\").angle = 0;\n    }\n    /**\n     * 打开碰撞\n     */\n    open_collider(){\n        this.node.getChildByName(\"hero_collider\").active = true;\n    }\n    /**\n     * 关闭碰撞\n     */\n    close_collider(){\n        this.node.getChildByName(\"hero_collider\").active = false;\n    }\n\n    /**\n     * 用于显示本次跳跃的最终得分,需要飘起来,还有可能出现光圈效果\n     * @param score 本次得分\n     * @returns \n     */\n    show_score(score:number){\n        this.hero_score.active = true;\n        this.hero_score.getChildByName(\"Label\").getComponent(Label).string = score+\"\";\n        tween(this.hero_score)\n        .to(1,{position:new Vec3(this.hero_score.getPosition().x,this.hero_score.getPosition().y+100)})\n        .call(()=>{\n            this.hero_score.setPosition(this.hero_score.getPosition().x,84);\n            this.hero_score.active = false;\n        })\n        .start();\n        if(score<=1){\n            return;\n        }\n        //打开光圈\n        this.light.active = true;\n        this.light.setScale(new Vec3(0.5,0.5));\n        tween(this.light)\n        .to(0.4,{scale:new Vec3(3,3)})\n        .call(()=>{\n            this.light.active =false;\n        })\n        .start();\n        // change alpha\n        let sprite = this.light.getComponent(Sprite);\n        sprite.color = new Color(sprite.color.r,sprite.color.g,sprite.color.b,255);\n\n        let base_color = sprite.color.clone();\n\n        let temp_color = new Color();\n        tween(sprite).to(0.4,{color:new Color(base_color.r,base_color.g,base_color.b,0)},{\n            onUpdate:(target?: object, ratio?: number)=>{\n                let alpha = base_color.a + 50 - base_color.a*ratio;\n                if(alpha>255){\n                    alpha = 255;\n                }\n                temp_color.set(base_color.r,base_color.g,base_color.b,alpha);\n                sprite.color = temp_color;\n            }\n        }).start();\n    }\n\n    /**\n     * 滑倒效果\n     */\n    slip(){\n       tween(this.node).by(0.5,{angle:Math.random()>0.5?30:-30}).start(); \n    }\n    /**\n     * 踏空效果\n     * @param target  目标箱子\n     * @param original 起跳时脚下的箱子\n     */\n    miss(target:Node,original:Node){\n        let target_pos = target.getComponent(BoxCtl).get_jump_position();\n        if(this.node.getPosition().y>target_pos.y){\n            target.setSiblingIndex(this.node.getSiblingIndex());\n        }else{\n            original.setSiblingIndex(this.node.getSiblingIndex());\n        }\n        tween(this.node)\n        .to(0.5,{position:new Vec3(this.node.getPosition().x,this.node.getPosition().y-80)}).start();\n    }\n\n    /**\n     * 蓄力特效,很多小球飞向英雄\n     * @returns \n     */\n    private jump_start_effect(){\n        if(this.node.getChildByName(\"ball_group\").children.length>30){\n            return;\n        }\n        let ball = instantiate(this.pre_ball);\n        {\n            //颜色RGB随机,透明度随机\n            let r = Math.floor(Math.random()*256);\n            let g = Math.floor(Math.random()*256);\n            let b = Math.floor(Math.random()*256);\n            let a = Math.floor(Math.random()*256);\n            if(Math.random()<0.5){\n                r = 255;\n                g = 255;\n                b = 255;\n            }\n            ball.getComponent(Sprite).color = new Color(r,g,b,a);\n        }\n        //x,y位置随机\n        let r_x = Math.random()*(200-(-200))+(-200);\n        let r_y = Math.random()*(250-(-50))+(-50);\n        ball.getComponent(UITransform).setContentSize(10,10);\n        ball.setParent(this.node.getChildByName(\"ball_group\"));\n        ball.setPosition(r_x,r_y);\n        tween(ball).to(Math.random()*(0.7-(0.2)+(0.2)),{position:new Vec3(Math.random()*(10-(-10)+(-10)),0)}).removeSelf().start();\n    }\n\n    /**\n     * 跳跃后落地效果,很多小球从英雄脚下飞溅\n     */\n    jump_end_effect(){\n\n        for(let i =0;i<30;i++){\n            let ball = instantiate(this.pre_ball);\n            {\n                 //颜色RGB随机,透明度随机\n                let r = Math.floor(Math.random()*256);\n                let g = Math.floor(Math.random()*256);\n                let b = Math.floor(Math.random()*256);\n                let a = Math.floor(Math.random()*256);\n                if(Math.random()<0.5){\n                    r = 255;\n                    g = 255;\n                    b = 255;\n                }\n                ball.getComponent(Sprite).color = new Color(r,g,b,a);\n            }\n             //x,y位置随机\n            let r_x = Math.random()*(150-(-110))+(-110);\n            let r_y = Math.random()*(150-(-50))+(-50);\n            ball.getComponent(UITransform).setContentSize(10,10);\n            ball.setParent(this.node.getChildByName(\"ball_group\"));\n            ball.setPosition(0,0);\n            tween(ball).to(Math.random()*(0.5-(0.2)+(0.2)),\n            {position:new Vec3(r_x,r_y)}).removeSelf().start();\n    \n        }\n\n        \n    }\n\n}\n\n"]}